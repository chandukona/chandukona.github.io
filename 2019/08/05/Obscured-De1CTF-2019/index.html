<!DOCTYPE html>
<html lang=en>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5" />
    <meta name="description" content="Challenge Description123nc 45.32.100.6 8003（Singapore）nc 39.108.37.223 8003 (China)  Attachment- task.py  task.py123456789101112131415161718192021222324252627282930313233343536373839404142434445464748">
<meta property="og:type" content="article">
<meta property="og:title" content="Obscured - De1CTF 2019">
<meta property="og:url" content="http://example.com/2019/08/05/Obscured-De1CTF-2019/index.html">
<meta property="og:site_name" content="chandu kona">
<meta property="og:description" content="Challenge Description123nc 45.32.100.6 8003（Singapore）nc 39.108.37.223 8003 (China)  Attachment- task.py  task.py123456789101112131415161718192021222324252627282930313233343536373839404142434445464748">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2019-08-05T10:09:14.000Z">
<meta property="article:modified_time" content="2022-12-09T01:29:33.586Z">
<meta property="article:author" content="Chandu Kona">
<meta property="article:tag" content="writeup">
<meta property="article:tag" content="crypto">
<meta property="article:tag" content="sbox">
<meta name="twitter:card" content="summary">
    
    
      
        
          <link rel="shortcut icon" href="/images/favicon.ico">
        
      
      
        
          <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
        
      
      
        
          <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
        
      
    
    <!-- title -->
    <title>Obscured - De1CTF 2019</title>
    <!-- styles -->
    
<link rel="stylesheet" href="/css/style.css">

    <!-- persian styles -->
    
    <!-- rss -->
    
    
	<!-- mathjax -->
	
		<script type="text/x-mathjax-config">
		  MathJax.Hub.Config({
			tex2jax: {
			  skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
			  inlineMath: [['$','$']]
			}
		  });
		</script>
		<script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-MML-AM_CHTML' async></script>
	
<!-- hexo injector head_end start -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-math@4.0.0/dist/style.css">
<!-- hexo injector head_end end --><meta name="generator" content="Hexo 5.4.2"></head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#" aria-label="Menu"><i class="fas fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#" aria-label="Menu"><i class="fas fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" aria-label="Top" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fas fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
        <!--
       --><li><a href="/">Home</a></li><!--
     --><!--
       --><li><a href="/about/">About</a></li><!--
     --><!--
       --><li><a href="/archives/">Writing</a></li><!--
     --><!--
       --><li><a href="/tags/">tags</a></li><!--
     -->
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" aria-label="Previous post" href="/2019/12/17/ECC-RSA-watevrCTF-2019/"><i class="fas fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" aria-label="Back to top" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" aria-label="Share post" href="#"><i class="fas fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=http://example.com/2019/08/05/Obscured-De1CTF-2019/"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=http://example.com/2019/08/05/Obscured-De1CTF-2019/&text=Obscured - De1CTF 2019"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=http://example.com/2019/08/05/Obscured-De1CTF-2019/&title=Obscured - De1CTF 2019"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=http://example.com/2019/08/05/Obscured-De1CTF-2019/&is_video=false&description=Obscured - De1CTF 2019"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=Obscured - De1CTF 2019&body=Check out this article: http://example.com/2019/08/05/Obscured-De1CTF-2019/"><i class="fas fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=http://example.com/2019/08/05/Obscured-De1CTF-2019/&title=Obscured - De1CTF 2019"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=http://example.com/2019/08/05/Obscured-De1CTF-2019/&title=Obscured - De1CTF 2019"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=http://example.com/2019/08/05/Obscured-De1CTF-2019/&title=Obscured - De1CTF 2019"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=http://example.com/2019/08/05/Obscured-De1CTF-2019/&title=Obscured - De1CTF 2019"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=http://example.com/2019/08/05/Obscured-De1CTF-2019/&name=Obscured - De1CTF 2019&description="><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=http://example.com/2019/08/05/Obscured-De1CTF-2019/&t=Obscured - De1CTF 2019"><i class="fab fa-hacker-news " aria-hidden="true"></i></a></li>
</ul>

    </div>
    <div id="toc">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Challenge-Description"><span class="toc-number">1.</span> <span class="toc-text">Challenge Description</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Attachment"><span class="toc-number">2.</span> <span class="toc-text">Attachment</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#task-py"><span class="toc-number">2.1.</span> <span class="toc-text">task.py</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Enryption-Block-Diagram"><span class="toc-number">3.</span> <span class="toc-text">Enryption Block Diagram</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Observation"><span class="toc-number">4.</span> <span class="toc-text">Observation</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Encryption-Algorithm"><span class="toc-number">4.1.</span> <span class="toc-text">Encryption Algorithm</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Function"><span class="toc-number">4.1.1.</span> <span class="toc-text">Function</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Round-1"><span class="toc-number">4.1.2.</span> <span class="toc-text">Round 1</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Round-2"><span class="toc-number">4.1.3.</span> <span class="toc-text">Round 2</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Round-3"><span class="toc-number">4.1.4.</span> <span class="toc-text">Round 3</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Round-4"><span class="toc-number">4.1.5.</span> <span class="toc-text">Round 4</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Round-5"><span class="toc-number">4.1.6.</span> <span class="toc-text">Round 5</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Round-6"><span class="toc-number">4.1.7.</span> <span class="toc-text">Round 6</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Exploit-Idea"><span class="toc-number">5.</span> <span class="toc-text">Exploit Idea</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Equations"><span class="toc-number">5.1.</span> <span class="toc-text">Equations</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Sbox"><span class="toc-number">5.2.</span> <span class="toc-text">Sbox</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Recovering-Sbox-Values"><span class="toc-number">5.3.</span> <span class="toc-text">Recovering Sbox - Values</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Recovering-Secret"><span class="toc-number">5.4.</span> <span class="toc-text">Recovering Secret</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Exploit"><span class="toc-number">6.</span> <span class="toc-text">Exploit</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Flag"><span class="toc-number">7.</span> <span class="toc-text">Flag</span></a></li></ol>
    </div>
  </span>
</div>

    
    <div class="content index py4">
        
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle" itemprop="name headline">
        Obscured - De1CTF 2019
    </h1>



    <div class="meta">
      <span class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span itemprop="name">Chandu Kona</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2019-08-05T10:09:14.000Z" itemprop="datePublished">2019-08-05</time>
        
      
    </div>


      
    <div class="article-category">
        <i class="fas fa-archive"></i>
        <a class="category-link" href="/categories/Crypto/">Crypto</a>
    </div>


      
    <div class="article-tag">
        <i class="fas fa-tag"></i>
        <a class="tag-link-link" href="/tags/crypto/" rel="tag">crypto</a>, <a class="tag-link-link" href="/tags/sbox/" rel="tag">sbox</a>, <a class="tag-link-link" href="/tags/writeup/" rel="tag">writeup</a>
    </div>


    </div>
  </header>
  

  <div class="content" itemprop="articleBody">
    <h2 id="Challenge-Description"><a href="#Challenge-Description" class="headerlink" title="Challenge Description"></a>Challenge Description</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">nc 45.32.100.6 8003（Singapore）</span><br><span class="line"></span><br><span class="line">nc 39.108.37.223 8003 (China)</span><br></pre></td></tr></table></figure>

<h2 id="Attachment"><a href="#Attachment" class="headerlink" title="Attachment"></a>Attachment</h2><pre><code>- task.py
</code></pre>
<h3 id="task-py"><a href="#task-py" class="headerlink" title="task.py"></a>task.py</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os,random,sys,string</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> sha256</span><br><span class="line"><span class="keyword">import</span> SocketServer</span><br><span class="line"><span class="keyword">import</span> signal</span><br><span class="line"><span class="keyword">from</span> FLAG <span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">pad</span>(<span class="params">x</span>):</span><br><span class="line">    pad_length = <span class="number">8</span>-<span class="built_in">len</span>(x)</span><br><span class="line">    <span class="keyword">return</span> pad_length*<span class="string">&#x27;0&#x27;</span>+x</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">hex2list</span>(<span class="params">x</span>):</span><br><span class="line">    res = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="number">32</span>,<span class="number">8</span>):</span><br><span class="line">        r = x[i:i+<span class="number">8</span>]</span><br><span class="line">        res.append(<span class="built_in">int</span>(r,<span class="number">16</span>))</span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">list2hex</span>(<span class="params">x</span>):</span><br><span class="line">    res = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>):</span><br><span class="line">        res += pad(<span class="built_in">hex</span>(x[i])[<span class="number">2</span>:])</span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line"><span class="comment"># Sbox is a secret permutation from F(2^32) to itself</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">Sbox</span>(<span class="params">plain</span>):</span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">        Obscured</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">encrypt</span>(<span class="params">msg</span>):</span><br><span class="line">    msg = hex2list(msg)</span><br><span class="line">    A , B , C , D = msg[<span class="number">0</span>],msg[<span class="number">1</span>],msg[<span class="number">2</span>],msg[<span class="number">3</span>]</span><br><span class="line">    <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">6</span>):</span><br><span class="line">        S = Sbox(A^C)</span><br><span class="line">        A , B , C , D = A ^ B ^ S , A ^ B ^ D ^ S , A ^ C ^ D , C ^ D ^ S </span><br><span class="line">    <span class="keyword">return</span> list2hex([A,B,C,D])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Task</span>(SocketServer.BaseRequestHandler):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">proof_of_work</span>(<span class="params">self</span>):</span><br><span class="line">        random.seed(os.urandom(<span class="number">8</span>))</span><br><span class="line">        proof = <span class="string">&#x27;&#x27;</span>.join([random.choice(string.ascii_letters+string.digits) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">20</span>)])</span><br><span class="line">        digest = sha256(proof).hexdigest()</span><br><span class="line">        self.request.send(<span class="string">&quot;sha256(XXXX+%s) == %s\n&quot;</span> % (proof[<span class="number">4</span>:],digest))</span><br><span class="line">        self.request.send(<span class="string">&#x27;Give me XXXX:&#x27;</span>)</span><br><span class="line">        x = self.request.recv(<span class="number">10</span>)</span><br><span class="line">        x = x.strip()</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(x) != <span class="number">4</span> <span class="keyword">or</span> sha256(x+proof[<span class="number">4</span>:]).hexdigest() != digest: </span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">recvhex</span>(<span class="params">self, sz</span>):</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            r = sz</span><br><span class="line">            res = <span class="string">&#x27;&#x27;</span></span><br><span class="line">            <span class="keyword">while</span> r&gt;<span class="number">0</span>:</span><br><span class="line">                res += self.request.recv(r)</span><br><span class="line">                <span class="keyword">if</span> res.endswith(<span class="string">&#x27;\n&#x27;</span>):</span><br><span class="line">                    r = <span class="number">0</span></span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    r = sz - <span class="built_in">len</span>(res)</span><br><span class="line">            res = res.strip()</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            res = <span class="string">&#x27;&#x27;</span></span><br><span class="line">        <span class="keyword">return</span> res.strip(<span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">dosend</span>(<span class="params">self, msg</span>):</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            self.request.sendall(msg)</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">handle</span>(<span class="params">self</span>):</span><br><span class="line">        signal.alarm(<span class="number">500</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> self.proof_of_work():</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        signal.alarm(<span class="number">450</span>)</span><br><span class="line">        secret = os.urandom(<span class="number">16</span>).encode(<span class="string">&#x27;hex&#x27;</span>)</span><br><span class="line">        s = encrypt(secret)</span><br><span class="line">        self.dosend(<span class="string">&#x27;Welcome to the Crypto System.\n&#x27;</span>)</span><br><span class="line">        self.dosend(<span class="string">&#x27;You can encrypt any plain you want and if you tell me the secret I will give you the flag.\n&#x27;</span>)    </span><br><span class="line">        self.dosend(<span class="string">&#x27;The enc_secret is: &#x27;</span>+s+<span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">        <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">20</span>):</span><br><span class="line">            self.dosend(<span class="string">&quot;Tell me the plaintext(hex): &quot;</span>)</span><br><span class="line">            pt = self.recvhex(<span class="number">33</span>)</span><br><span class="line">            <span class="keyword">if</span> pt==<span class="string">&#x27;&#x27;</span>:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">len</span>(pt)!=<span class="number">32</span>:</span><br><span class="line">                self.dosend(<span class="string">&#x27;The length must be 32!!!\n&#x27;</span>)</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            ct = encrypt(pt)</span><br><span class="line">            self.dosend(<span class="string">&quot;The result is: %s\n&quot;</span> % ct)</span><br><span class="line">        self.dosend(<span class="string">&#x27;Tell me the secret and I will give you the flag.\n&#x27;</span>)</span><br><span class="line">        self.dosend(<span class="string">&#x27;Secret(hex):\n&#x27;</span>)</span><br><span class="line">        sc = self.recvhex(<span class="number">33</span>)</span><br><span class="line">        <span class="keyword">if</span> sc==secret:</span><br><span class="line">            self.dosend(<span class="string">&#x27;Wow! How smart you are! Here is your flag:\n&#x27;</span>)</span><br><span class="line">            self.dosend(flag)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            self.dosend(<span class="string">&#x27;Sorry you are wrong!\n&#x27;</span>)</span><br><span class="line">        self.request.close()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ForkedServer</span>(SocketServer.ForkingTCPServer, SocketServer.TCPServer):</span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    HOST, PORT = <span class="string">&#x27;0.0.0.0&#x27;</span>, <span class="number">8003</span></span><br><span class="line">    server = ForkedServer((HOST, PORT), Task)</span><br><span class="line">    server.allow_reuse_address = <span class="literal">True</span></span><br><span class="line">    server.serve_forever()</span><br></pre></td></tr></table></figure>

<h2 id="Enryption-Block-Diagram"><a href="#Enryption-Block-Diagram" class="headerlink" title="Enryption Block Diagram"></a>Enryption Block Diagram</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">                                         one - Round </span><br><span class="line"></span><br><span class="line">                                       Message-Block</span><br><span class="line">-----------------------------------------------------------------------------------------</span><br><span class="line">|          A          |          B          |          C          |          D          |</span><br><span class="line">-----------------------------------------------------------------------------------------</span><br><span class="line">                |                |                   |   |                   |</span><br><span class="line">            A--&gt;|            B--&gt;|               C--&gt;|   |&lt;--C               |&lt;--D</span><br><span class="line">                |---------------/--------------------⊕   |                   |  </span><br><span class="line">                |              /                A⊕C-&gt;|   |------⊕------------|</span><br><span class="line">                |             /               -------------     |            |</span><br><span class="line">                |            /                |           |     |            |</span><br><span class="line">                |           |                 |   S-Box   |     |            |</span><br><span class="line">                |       B--&gt;|                 |           |     |&lt;-C⊕D       |</span><br><span class="line">                |        ---|                 -------------     |            |</span><br><span class="line">                |        |                         |            |            |</span><br><span class="line">                |        V                     S--&gt;|            |            |</span><br><span class="line">    ------------|-------&gt;⊕&lt;------------------------|            |            |</span><br><span class="line">    |                    |                         |            |            |</span><br><span class="line">    |                    |&lt;--A⊕B⊕S                 |            |            |</span><br><span class="line">    |       -------------|                         |            |            |</span><br><span class="line">    |       |                                      |&lt;--S        |            |</span><br><span class="line">    |       |---------------&gt;⊕&lt;--------------------|------------|------------|</span><br><span class="line">    |       |          ^     |   ^                 |            |      </span><br><span class="line">    |       |          |     |   |                 |-----------/-----------|</span><br><span class="line">    |       |       A⊕B⊕S    |   D                            /            |</span><br><span class="line">    |       |                |                        C⊕D--&gt; /             |&lt;--S</span><br><span class="line">    |       |                |&lt;--A⊕B⊕S⊕D                    /              |</span><br><span class="line">    |       |                |                   A         |---------------⊕</span><br><span class="line">A--&gt;|       |                |                   |         |               |</span><br><span class="line">    |       |                |                   V         V               |</span><br><span class="line">    |-------|----------------|----------------------------&gt;⊕               |</span><br><span class="line">            |                |                             |               |</span><br><span class="line">            |                |                             |               |</span><br><span class="line">            |                |                             |               |</span><br><span class="line">            |&lt;--A⊕B⊕S        |&lt;--A⊕B⊕S⊕D                   |&lt;--A⊕C⊕D       |&lt;--A⊕C⊕D⊕S</span><br><span class="line">            |                |                             |               |</span><br><span class="line">            |                |                             |               |</span><br><span class="line">            V                V                             V               V</span><br><span class="line">-----------------------------------------------------------------------------------------</span><br><span class="line">|          A          |          B          |          C          |          D          |</span><br><span class="line">-----------------------------------------------------------------------------------------</span><br></pre></td></tr></table></figure>

<h2 id="Observation"><a href="#Observation" class="headerlink" title="Observation"></a>Observation</h2><p>This challenge is inspired from <a target="_blank" rel="noopener" href="https://nsucrypto.nsu.ru/archive/2017/round/2/task/2/#data">NSUCRYPTO-2017 TwinPeaks</a>, but in a short view we can see that server uses a custom encryption algorithm (similar to TwinPeaks) to encrypt a 16 byte block of random bytes and our goal is to get the <code>secret</code> just by knowing the ciphertext, server also allows us to encrypt our own plaintext <code>20 times</code>, howerver we can solve the challenge just by using 6 queries.</p>
<h3 id="Encryption-Algorithm"><a href="#Encryption-Algorithm" class="headerlink" title="Encryption Algorithm"></a>Encryption Algorithm</h3><h4 id="Function"><a href="#Function" class="headerlink" title="Function"></a>Function</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">encrypt</span>(<span class="params">msg</span>):</span><br><span class="line">    msg = hex2list(msg)</span><br><span class="line">    A , B , C , D = msg[<span class="number">0</span>],msg[<span class="number">1</span>],msg[<span class="number">2</span>],msg[<span class="number">3</span>]</span><br><span class="line">    <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">6</span>):</span><br><span class="line">        S = Sbox(A^C)</span><br><span class="line">        A , B , C , D = A ^ B ^ S , A ^ B ^ D ^ S , A ^ C ^ D , C ^ D ^ S </span><br><span class="line">    <span class="keyword">return</span> list2hex([A,B,C,D])</span><br></pre></td></tr></table></figure>

<p>If we notice the encryption algorithm, most of the part of the algorithm is just <code>xoring</code> and an <code>Sbox</code> which is an unkown function, but how can we even think of decrypting an unknown encryption algorithm (either with or without the key), which turns out since the whole encryption process excluding Sbox is just Xoring it is more likely to get the repeatition of the same data and get cancelled out and this makes it feassable to make equations and get what we want.</p>
<p>let’s observe what’s happening in each round</p>
<h4 id="Round-1"><a href="#Round-1" class="headerlink" title="Round 1"></a>Round 1</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">S0  =    Sbox(A0 ^ C0)</span><br><span class="line">A1  =    A0     ^    B0  ^   S0</span><br><span class="line">B1  =    A0     ^    B0  ^   D0  ^   S0</span><br><span class="line">C1  =    A0     ^    C0  ^   D0</span><br><span class="line">D1  =    C0     ^    D0  ^   S0</span><br></pre></td></tr></table></figure>

<h4 id="Round-2"><a href="#Round-2" class="headerlink" title="Round 2"></a>Round 2</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">S1  =    Sbox(A1 ^ C1)                      =   Sbox(B0 ^ C0 ^ D0 ^ S0)</span><br><span class="line">A2  =    A1     ^    B1  ^   S1             =   D0     ^    S1</span><br><span class="line">B2  =    A1     ^    B1  ^   D1  ^   S1     =   C0     ^    S0  ^   S1</span><br><span class="line">C2  =    A1     ^    C1  ^   D1             =   B0</span><br><span class="line">D2  =    C1     ^    D1  ^   S1             =   A0     ^    S0  ^   S1</span><br></pre></td></tr></table></figure>

<h4 id="Round-3"><a href="#Round-3" class="headerlink" title="Round 3"></a>Round 3</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">S2  =    Sbox(A2 ^ C2)                      =   Sbox(B0 ^ D0 ^ S1)</span><br><span class="line">A3  =    A2     ^    B2  ^   S2             =   C0     ^    D0  ^   S0  ^   S2</span><br><span class="line">B3  =    A2     ^    B2  ^   D2  ^   S2     =   A0     ^    C0  ^   D0  ^   S1  ^   S2</span><br><span class="line">C3  =    A2     ^    C2  ^   D2             =   A0     ^    B0  ^   D0  ^   S0</span><br><span class="line">D3  =    C2     ^    D2  ^   S2             =   A0     ^    B0  ^   S0  ^   S1  ^   S2</span><br></pre></td></tr></table></figure>

<h4 id="Round-4"><a href="#Round-4" class="headerlink" title="Round 4"></a>Round 4</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">S3  =    Sbox(A3 ^ C3)                      =   Sbox(A0 ^ B0 ^ C0 ^ S2)</span><br><span class="line">A4  =    A3     ^    B3  ^   S3             =   A0     ^    S0  ^   S1  ^   S3</span><br><span class="line">B4  =    A3     ^    B3  ^   D3  ^   S3     =   B0     ^    S2  ^   S3</span><br><span class="line">C4  =    A3     ^    C3  ^   D3             =   C0     ^    S0  ^   S1</span><br><span class="line">D4  =    C3     ^    D3  ^   S3             =   D0     ^    S1  ^   S2  ^   S3</span><br></pre></td></tr></table></figure>

<h4 id="Round-5"><a href="#Round-5" class="headerlink" title="Round 5"></a>Round 5</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">S4  =    Sbox(A4 ^ C4)                      =   Sbox(A0 ^ C0 ^ S3)</span><br><span class="line">A5  =    A4     ^    B4  ^   S4             =   A0     ^    B0  ^   S0  ^   S1  ^   S2  ^   S4</span><br><span class="line">B5  =    A4     ^    B4  ^   D4  ^   S4     =   A0     ^    B0  ^   D0  ^   S0  ^   S3  ^   S4</span><br><span class="line">C5  =    A4     ^    C4  ^   D4             =   A0     ^    C0  ^   D0  ^   S1  ^   S2</span><br><span class="line">D5  =    C4     ^    D4  ^   S4             =   C0     ^    D0  ^   S0  ^   S2  ^   S3  ^   S4</span><br></pre></td></tr></table></figure>

<h4 id="Round-6"><a href="#Round-6" class="headerlink" title="Round 6"></a>Round 6</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">S5  =    Sbox(A5 ^ C5)                      =   Sbox(B0 ^ C0 ^ D0 ^ S0 ^ S4)</span><br><span class="line">A6  =    A5     ^    B5  ^   S5             =   D0     ^    S1  ^   S2  ^   S3  ^   S5</span><br><span class="line">B6  =    A5     ^    B5  ^   D5  ^   S5     =   C0     ^    S0  ^   S1  ^   S4  ^   S5</span><br><span class="line">C6  =    A5     ^    C5  ^   D5             =   B0     ^    S2  ^   S3</span><br><span class="line">D6  =    C5     ^    D5  ^   S5             =   A0     ^    S0  ^   S1  ^   S3  ^   S4  ^   S5</span><br></pre></td></tr></table></figure>

<h2 id="Exploit-Idea"><a href="#Exploit-Idea" class="headerlink" title="Exploit Idea"></a>Exploit Idea</h2><p>If we notice the equations of Round-6 we can say that <code>a6, b6, c6, d6</code> are equal to <code>a0, b0, c0, d0</code> with a lot of <code>S&#39;s</code> xored, since it’s just the bunch of s’s that are xored extra if we can able to cancel them out we can find <code>a0, b0, c0, d0</code>.</p>
<h3 id="Equations"><a href="#Equations" class="headerlink" title="Equations"></a>Equations</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">A6  =   D0     ^    S1  ^   S2  ^   S3  ^   S5</span><br><span class="line">B6  =   C0     ^    S0  ^   S1  ^   S4  ^   S5</span><br><span class="line">C6  =   B0     ^    S2  ^   S3</span><br><span class="line">D6  =   A0     ^    S0  ^   S1  ^   S3  ^   S4  ^   S5</span><br></pre></td></tr></table></figure>

<p>Rearranging them gives us</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">D0  =   A6     ^    S1  ^   S2  ^   S3  ^   S5</span><br><span class="line">C0  =   B6     ^    S0  ^   S1  ^   S4  ^   S5</span><br><span class="line">B0  =   C6     ^    S2  ^   S3</span><br><span class="line">A0  =   D6     ^    S0  ^   S1  ^   S3  ^   S4  ^   S5</span><br></pre></td></tr></table></figure>

<p>so, to recover the plaintext we need to know the values of all <code>S&#39;s</code>. here in this case we can recover at most of 2 s values <code>S2</code> and <code>S3</code> If we know <code>A0 and C0</code> by rearranging the equations:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">B6 ^ D6 :</span><br><span class="line">            C0  ^   S0  ^   S1      ^       S4  ^   S5</span><br><span class="line"></span><br><span class="line">                             ⊕</span><br><span class="line">            </span><br><span class="line">            A0  ^   S0  ^   S1  ^   S3  ^   S4  ^   S5</span><br><span class="line">        ------------------------------------------------</span><br><span class="line">                    A0  ^   C0  ^   S3</span><br><span class="line"></span><br><span class="line">S3  =   B6  ^   D6  ^   A0  ^   C0</span><br></pre></td></tr></table></figure>

<p>now with the value of <code>S3 and B0</code> we can recover s2 as well:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">C6  =   B0  ^   S2  ^   S3  </span><br><span class="line">                        </span><br><span class="line">                            ==&gt; S2  =   C6  ^   B0  ^   S3</span><br></pre></td></tr></table></figure>

<p>since we should know the plaintext to recover <code>S2 and S3</code>, we cannot recover the <code>S-values</code> of the <code>secret</code>. this leads us to use the queries and try to get the <code>S</code> values we need. If we look at all the s-equations:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">S0  =   Sbox(   A0 ^ C0                     )</span><br><span class="line">S1  =   Sbox(   B0 ^ C0 ^ D0 ^ S0           )</span><br><span class="line">S2  =   Sbox(   B0 ^ D0 ^ S1                )</span><br><span class="line">S3  =   Sbox(   A0 ^ B0 ^ C0 ^ S2           )</span><br><span class="line">S4  =   Sbox(   A0 ^ C0 ^ S3                )</span><br><span class="line">S5  =   Sbox(   B0 ^ C0 ^ D0 ^ S0 ^ S4      )</span><br></pre></td></tr></table></figure>

<p>Since, we can recover <code>S2 and S3</code> if we could craft the plaintext such that we get the output of <code>Sbox</code> function, we can recover all the <code>S0-S5</code> values and be able to recover the <code>secret</code>. My idea is to craft the message such that <code>B0 ^ C0 ^ D0 ^ S0</code> will give the value we need so we get the value of <code>S2</code> which is <code>Sbox(value needed)</code> but we don’t know the value of <code>S0</code>, so if we craft our msg having <code>A0 = m, B0 = m, C0 = m ^ x, D0 = Sbox(x)</code> value of <code>S0</code> will be <code>Sbox(x)</code> since <code>S0 = Sbox( A0 ^ C0 ) = Sbox(  m ^ m ^ x   ) = Sbox(x)</code> and in the equation of <code>S1</code> -&gt; <code>B0 ^ C0 ^ D0 ^ S0 = m ^ m ^ x ^ Sbox(x) ^ Sbox(x) = x</code> so <code>S1 = Sbox(x) = S0 = D0</code> now in the equation of <code>S2</code> -&gt; <code>B0 ^ D0 ^ S1 =  B0</code> since <code>S0 == S1 == D0</code> and <code>B0 == m</code> now the value of <code>S2</code> is <code>Sbox(m)</code> the value we need, but for to do all this we need a pair of input and output values of <code>Sbox()</code> for that we can send 0 as message then the equations are like:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">S0  =   Sbox(   A0 ^ C0                 )   =   Sbox(   <span class="number">0</span>   )</span><br><span class="line">S1  =   Sbox(   B0 ^ C0 ^ D0 ^ S0       )   =   Sbox(   S0  )</span><br><span class="line">S2  =   Sbox(   B0 ^ D0 ^ S1            )   =   Sbox(   S1  )</span><br><span class="line">S3  =   Sbox(   A0 ^ B0 ^ C0 ^ S2       )   =   Sbox(   S2  )</span><br><span class="line">S4  =   Sbox(   A0 ^ C0 ^ S3            )   =   Sbox(   S3  )</span><br><span class="line">S5  =   Sbox(   B0 ^ C0 ^ D0 ^ S0 ^ S4  )   =   Sbox(   S4  )</span><br></pre></td></tr></table></figure>

<p>since we can recover <code>S2</code> and <code>S3</code> values and <code>S3 = Sbox(S2)</code> we have an input-output pair. let <code>x = S2</code> and <code>y = S3</code>, now we can craft our message such that we get the <code>Sbox(m)</code> of <code>m</code> we need, for that the msg will be <code>A0 = m, B0 = m, C0 = m ^ x, D0 = y</code> and by recovering <code>S2</code> from the ciphertext we get <code>Sbox(m)</code>.</p>
<h3 id="Sbox"><a href="#Sbox" class="headerlink" title="Sbox"></a>Sbox</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">SBox</span>(<span class="params">m</span>):</span><br><span class="line">    x = inp = <span class="number">3452694591</span>    <span class="comment"># hardcoded the values</span></span><br><span class="line">    y = out = <span class="number">2745719712</span></span><br><span class="line">    A0 = m</span><br><span class="line">    B0 = m</span><br><span class="line">    C0 = m ^ x</span><br><span class="line">    D0 = y</span><br><span class="line">    pt = list2hex([A0, B0, C0, D0])</span><br><span class="line">    <span class="comment"># encrypt here</span></span><br><span class="line">    ct = encrypt(pt)</span><br><span class="line">    A6, B6, C6, D6 = hex2list(ct)</span><br><span class="line">    s2 = C6 ^ B0 ^ A0 ^ C0 ^ B6 ^ D6  <span class="comment"># Read the really long hypothesis</span></span><br><span class="line">    <span class="keyword">return</span> s2   <span class="comment"># Sbox(m)</span></span><br></pre></td></tr></table></figure>

<p>now we officially have an oracle which gives the output of <code>Sbox()</code>, and all we need is to get all the 5 <code>S</code> values to recover the <code>secret</code>.</p>
<h3 id="Recovering-Sbox-Values"><a href="#Recovering-Sbox-Values" class="headerlink" title="Recovering Sbox - Values"></a>Recovering Sbox - Values</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">start = io.recvuntil(<span class="string">&#x27;): &#x27;</span>)</span><br><span class="line">secret = res.search(start).group()</span><br><span class="line">A6, B6, C6, D6 = hex2list(secret)</span><br><span class="line">m1 = B6 ^ D6</span><br><span class="line">m2 = B6 ^ D6 ^ C6</span><br><span class="line">m3 = C6 ^ A6 ^ B6</span><br><span class="line"></span><br><span class="line">S4 = SBox(m1)</span><br><span class="line">S3 = SBox(m2)</span><br><span class="line">S5 = SBox(m3)</span><br><span class="line"></span><br><span class="line">m4 = C6 ^ A6 ^ S6</span><br><span class="line">m5 = B6 ^ D6 ^ S4</span><br><span class="line"></span><br><span class="line">S0 = SBox(m5)</span><br><span class="line">S2 = SBox(m4)</span><br><span class="line"></span><br><span class="line"><span class="comment">#m6 = B6 ^ C6 ^ D6 ^ S0</span></span><br><span class="line">m6 = C6 ^ A6 ^ B6 ^ S5</span><br><span class="line">S1 = SBox(m6)</span><br></pre></td></tr></table></figure>

<p>now we have the required values to recover plaintext.</p>
<h3 id="Recovering-Secret"><a href="#Recovering-Secret" class="headerlink" title="Recovering Secret"></a>Recovering Secret</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">tab6 = &#123;</span><br><span class="line">    <span class="string">&#x27;A6&#x27;</span>: [<span class="string">&#x27;D0&#x27;</span>, <span class="string">&#x27;S1&#x27;</span>, <span class="string">&#x27;S2&#x27;</span>, <span class="string">&#x27;S3&#x27;</span>, <span class="string">&#x27;S5&#x27;</span>],</span><br><span class="line">    <span class="string">&#x27;B6&#x27;</span>: [<span class="string">&#x27;C0&#x27;</span>, <span class="string">&#x27;S0&#x27;</span>, <span class="string">&#x27;S1&#x27;</span>, <span class="string">&#x27;S4&#x27;</span>, <span class="string">&#x27;S5&#x27;</span>],</span><br><span class="line">    <span class="string">&#x27;C6&#x27;</span>: [<span class="string">&#x27;B0&#x27;</span>, <span class="string">&#x27;S2&#x27;</span>, <span class="string">&#x27;B3&#x27;</span>],</span><br><span class="line">    <span class="string">&#x27;D6&#x27;</span>: [<span class="string">&#x27;A0&#x27;</span>, <span class="string">&#x27;S0&#x27;</span>, <span class="string">&#x27;S1&#x27;</span>, <span class="string">&#x27;S3&#x27;</span>, <span class="string">&#x27;S4&#x27;</span>, <span class="string">&#x27;S5&#x27;</span>]</span><br><span class="line"></span><br><span class="line">A0 = B0 = C0 = D0 = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> op <span class="keyword">in</span> tab0.keys():</span><br><span class="line">    <span class="built_in">exec</span>(op+<span class="string">&#x27; = &#x27;</span>+<span class="string">&#x27; ^ &#x27;</span>.join(tab0[op]))</span><br><span class="line"><span class="built_in">print</span> list2hex([A0, B0, C0, D0])</span><br></pre></td></tr></table></figure>

<p>sending this <code>secret</code> to server gives us the flag.</p>
<h2 id="Exploit"><a href="#Exploit" class="headerlink" title="Exploit"></a>Exploit</h2><pre><code>- the variable names in the exploit are a bit different!!!
</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> sha256</span><br><span class="line"><span class="keyword">from</span> string <span class="keyword">import</span> printable</span><br><span class="line"><span class="keyword">from</span> pwnlib.util.iters <span class="keyword">import</span> bruteforce</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line">res = re.<span class="built_in">compile</span>(<span class="string">r&#x27;[a-z0-9]&#123;32&#125;&#x27;</span>)</span><br><span class="line">io = remote(<span class="string">&#x27;45.32.100.6&#x27;</span>, <span class="number">8003</span>)</span><br><span class="line"><span class="comment">#io = remote(&#x27;localhost&#x27;, 8003)</span></span><br><span class="line">cookie, <span class="built_in">hash</span> = io.recvline().strip().split(<span class="string">&#x27; == &#x27;</span>)</span><br><span class="line">cookie = cookie.split(<span class="string">&#x27;XXXX+&#x27;</span>)[<span class="number">1</span>][:-<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">brute_force</span>(<span class="params"><span class="built_in">hash</span>, s</span>):</span><br><span class="line">    <span class="keyword">return</span> bruteforce(<span class="keyword">lambda</span> x: sha256(x+s).hexdigest() == <span class="built_in">hash</span>, string.  digits+string.ascii_letters, length=<span class="number">4</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">io.sendline(brute_force(<span class="built_in">hash</span>, cookie))</span><br><span class="line"><span class="comment"># POC till here</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># def gen(n):</span></span><br><span class="line"><span class="comment">#     sub = &#123;</span></span><br><span class="line"><span class="comment">#             &quot;S&#123;&#125;&quot;.format(n+1):[&quot;S&#123;&#125;&quot;.format(n+1)],</span></span><br><span class="line"><span class="comment">#             &quot;A&#123;&#125;&quot;.format(n):&quot;A&#123;&#125; B&#123;&#125; S&#123;&#125;&quot;.format(n-1,n-1,n).split(),</span></span><br><span class="line"><span class="comment">#             &quot;B&#123;&#125;&quot;.format(n):&quot;A&#123;&#125; B&#123;&#125; D&#123;&#125; S&#123;&#125;&quot;.format(n-1,n-1,n-1,n).split(),</span></span><br><span class="line"><span class="comment">#             &quot;C&#123;&#125;&quot;.format(n):&quot;A&#123;&#125; C&#123;&#125; D&#123;&#125;&quot;.format(n-1,n-1,n-1).split(),</span></span><br><span class="line"><span class="comment">#             &quot;D&#123;&#125;&quot;.format(n):&quot;C&#123;&#125; D&#123;&#125; S&#123;&#125;&quot;.format(n-1,n-1,n).split(),</span></span><br><span class="line"><span class="comment">#     &#125;</span></span><br><span class="line"><span class="comment">#     if n==0:</span></span><br><span class="line"><span class="comment">#         sub = &#123;</span></span><br><span class="line"><span class="comment">#                 &quot;S1&quot;:[&#x27;S1&#x27;],</span></span><br><span class="line"><span class="comment">#                 &quot;A0&quot;:[&#x27;A0&#x27;],</span></span><br><span class="line"><span class="comment">#                 &quot;B0&quot;:[&#x27;B0&#x27;],</span></span><br><span class="line"><span class="comment">#                 &quot;C0&quot;:[&#x27;C0&#x27;],</span></span><br><span class="line"><span class="comment">#                 &quot;D0&quot;:[&#x27;D0&#x27;],</span></span><br><span class="line"><span class="comment">#                 &#125;</span></span><br><span class="line"><span class="comment">#     return sub</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># chars = &quot;ABCD&quot;</span></span><br><span class="line"><span class="comment"># def parser(n):</span></span><br><span class="line"><span class="comment">#     def gf(l):</span></span><br><span class="line"><span class="comment">#         re = []</span></span><br><span class="line"><span class="comment">#         s = set(l)</span></span><br><span class="line"><span class="comment">#         for op in s:</span></span><br><span class="line"><span class="comment">#             if l.count(op)%2!=0:</span></span><br><span class="line"><span class="comment">#                 re.append(op)</span></span><br><span class="line"><span class="comment">#         return re</span></span><br><span class="line"><span class="comment">#     game = n</span></span><br><span class="line"><span class="comment">#     subn = gen(n)</span></span><br><span class="line"><span class="comment">#     while(n&gt;0):</span></span><br><span class="line"><span class="comment">#         subm = gen(n-1)</span></span><br><span class="line"><span class="comment">#         for c in chars:</span></span><br><span class="line"><span class="comment">#             k = c+str(game)</span></span><br><span class="line"><span class="comment">#             currents = subn[k][:]</span></span><br><span class="line"><span class="comment">#             for op in currents:</span></span><br><span class="line"><span class="comment">#                 if op[0] == &#x27;S&#x27;: continue</span></span><br><span class="line"><span class="comment">#                 subn[k].remove(op)</span></span><br><span class="line"><span class="comment">#                 subn[k] = subn[k]+subm[op]</span></span><br><span class="line"><span class="comment">#         n-=1</span></span><br><span class="line"><span class="comment">#     for c in chars:</span></span><br><span class="line"><span class="comment">#         k = c+str(game)</span></span><br><span class="line"><span class="comment">#         check = subn[k][:]</span></span><br><span class="line"><span class="comment">#         subn[k] = gf(check)</span></span><br><span class="line"><span class="comment">#     return subn</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">pad</span>(<span class="params">x</span>):</span><br><span class="line">    pad_length = <span class="number">8</span>-<span class="built_in">len</span>(x)</span><br><span class="line">    <span class="keyword">return</span> pad_length*<span class="string">&#x27;0&#x27;</span>+x</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">hex2list</span>(<span class="params">x</span>):</span><br><span class="line">    res = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="number">32</span>, <span class="number">8</span>):</span><br><span class="line">        r = x[i:i+<span class="number">8</span>]</span><br><span class="line">        res.append(<span class="built_in">int</span>(r, <span class="number">16</span>))</span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">list2hex</span>(<span class="params">x</span>):</span><br><span class="line">    res = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>):</span><br><span class="line">        res += pad(<span class="built_in">hex</span>(x[i])[<span class="number">2</span>:])</span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># def check(inp, out):</span></span><br><span class="line"><span class="comment">#     a0,b0,c0,d0 = hex2list(inp)</span></span><br><span class="line"><span class="comment">#     a6,b6,c6,d6 = hex2list(out)</span></span><br><span class="line"><span class="comment">#     s4 = b6 ^ d6 ^ a0 ^ c0</span></span><br><span class="line"><span class="comment">#     s3 = c6 ^ b0 ^ s4</span></span><br><span class="line"><span class="comment">#     print s3, s4</span></span><br><span class="line"><span class="comment">#     print a0 ^ b0 ^ c0 ^ s3, s4</span></span><br><span class="line"><span class="comment">#     return a0 ^ b0 ^ c0 ^ s3, s4</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># local</span></span><br><span class="line">x = inp = <span class="number">0</span></span><br><span class="line">y = out = <span class="number">10</span></span><br><span class="line"></span><br><span class="line">x = inp = <span class="number">3452694591</span></span><br><span class="line">y = out = <span class="number">2745719712</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Table of [ABCD6]</span></span><br><span class="line"><span class="comment"># tab6 = parser(6)</span></span><br><span class="line">tab6 = &#123;</span><br><span class="line">    <span class="string">&#x27;A6&#x27;</span>: [<span class="string">&#x27;S2&#x27;</span>, <span class="string">&#x27;S1&#x27;</span>, <span class="string">&#x27;S5&#x27;</span>, <span class="string">&#x27;S3&#x27;</span>, <span class="string">&#x27;D0&#x27;</span>],</span><br><span class="line">    <span class="string">&#x27;B6&#x27;</span>: [<span class="string">&#x27;S0&#x27;</span>, <span class="string">&#x27;S1&#x27;</span>, <span class="string">&#x27;S4&#x27;</span>, <span class="string">&#x27;S5&#x27;</span>, <span class="string">&#x27;C0&#x27;</span>],</span><br><span class="line">    <span class="string">&#x27;C6&#x27;</span>: [<span class="string">&#x27;S2&#x27;</span>, <span class="string">&#x27;S3&#x27;</span>, <span class="string">&#x27;B0&#x27;</span>],</span><br><span class="line">    <span class="string">&#x27;D6&#x27;</span>: [<span class="string">&#x27;S3&#x27;</span>, <span class="string">&#x27;S1&#x27;</span>, <span class="string">&#x27;S0&#x27;</span>, <span class="string">&#x27;S5&#x27;</span>, <span class="string">&#x27;S4&#x27;</span>, <span class="string">&#x27;A0&#x27;</span>]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># Table of [ABCD]0</span></span><br><span class="line">tab0 = &#123;</span><br><span class="line">    <span class="string">&#x27;D0&#x27;</span>: [<span class="string">&#x27;S3&#x27;</span>, <span class="string">&#x27;S2&#x27;</span>, <span class="string">&#x27;S6&#x27;</span>, <span class="string">&#x27;S4&#x27;</span>, <span class="string">&#x27;A6&#x27;</span>],</span><br><span class="line">    <span class="string">&#x27;C0&#x27;</span>: [<span class="string">&#x27;S2&#x27;</span>, <span class="string">&#x27;S1&#x27;</span>, <span class="string">&#x27;S6&#x27;</span>, <span class="string">&#x27;S5&#x27;</span>, <span class="string">&#x27;B6&#x27;</span>],</span><br><span class="line">    <span class="string">&#x27;B0&#x27;</span>: [<span class="string">&#x27;S3&#x27;</span>, <span class="string">&#x27;S4&#x27;</span>, <span class="string">&#x27;C6&#x27;</span>],</span><br><span class="line">    <span class="string">&#x27;A0&#x27;</span>: [<span class="string">&#x27;S2&#x27;</span>, <span class="string">&#x27;S1&#x27;</span>, <span class="string">&#x27;S6&#x27;</span>, <span class="string">&#x27;S5&#x27;</span>, <span class="string">&#x27;S4&#x27;</span>, <span class="string">&#x27;D6&#x27;</span>]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># Sn based on 6&#x27;s</span></span><br><span class="line"><span class="comment">## S1 = f(S4 ^ B6 ^ D6)</span></span><br><span class="line">tabSn6 = &#123;</span><br><span class="line">    <span class="string">&#x27;S1&#x27;</span>: [<span class="string">&#x27;S4&#x27;</span>, <span class="string">&#x27;B6&#x27;</span>, <span class="string">&#x27;D6&#x27;</span>],</span><br><span class="line">    <span class="string">&#x27;S2&#x27;</span>: [<span class="string">&#x27;S5&#x27;</span>, <span class="string">&#x27;A6&#x27;</span>, <span class="string">&#x27;B6&#x27;</span>, <span class="string">&#x27;C6&#x27;</span>],</span><br><span class="line">    <span class="string">&#x27;S3&#x27;</span>: [<span class="string">&#x27;C6&#x27;</span>, <span class="string">&#x27;A6&#x27;</span>, <span class="string">&#x27;S6&#x27;</span>],</span><br><span class="line">    <span class="string">&#x27;S4&#x27;</span>: [<span class="string">&#x27;B6&#x27;</span>, <span class="string">&#x27;C6&#x27;</span>, <span class="string">&#x27;D6&#x27;</span>],</span><br><span class="line">    <span class="string">&#x27;S5&#x27;</span>: [<span class="string">&#x27;B6&#x27;</span>, <span class="string">&#x27;D6&#x27;</span>],</span><br><span class="line">    <span class="string">&#x27;S6&#x27;</span>: [<span class="string">&#x27;A6&#x27;</span>, <span class="string">&#x27;B6&#x27;</span>, <span class="string">&#x27;C6&#x27;</span>],</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># Sn based on 0&#x27;s</span></span><br><span class="line"><span class="comment">## S1 = f(a0 ^ c0)</span></span><br><span class="line">tabSn0 = &#123;</span><br><span class="line">    <span class="string">&#x27;S1&#x27;</span>: [<span class="string">&#x27;A0&#x27;</span>, <span class="string">&#x27;C0&#x27;</span>],</span><br><span class="line">    <span class="string">&#x27;S2&#x27;</span>: [<span class="string">&#x27;B0&#x27;</span>, <span class="string">&#x27;C0&#x27;</span>, <span class="string">&#x27;D0&#x27;</span>, <span class="string">&#x27;S1&#x27;</span>],</span><br><span class="line">    <span class="string">&#x27;S3&#x27;</span>: [<span class="string">&#x27;B0&#x27;</span>, <span class="string">&#x27;D0&#x27;</span>, <span class="string">&#x27;S2&#x27;</span>],</span><br><span class="line">    <span class="string">&#x27;S4&#x27;</span>: [<span class="string">&#x27;A0&#x27;</span>, <span class="string">&#x27;B0&#x27;</span>, <span class="string">&#x27;C0&#x27;</span>, <span class="string">&#x27;S3&#x27;</span>],</span><br><span class="line">    <span class="string">&#x27;S5&#x27;</span>: [<span class="string">&#x27;A0&#x27;</span>, <span class="string">&#x27;C0&#x27;</span>, <span class="string">&#x27;S4&#x27;</span>],</span><br><span class="line">    <span class="string">&#x27;S6&#x27;</span>: [<span class="string">&#x27;B0&#x27;</span>, <span class="string">&#x27;C0&#x27;</span>, <span class="string">&#x27;D0&#x27;</span>, <span class="string">&#x27;S1&#x27;</span>, <span class="string">&#x27;S5&#x27;</span>],</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">encrypt</span>(<span class="params">pt, io=io</span>):</span><br><span class="line">    time.sleep(<span class="number">0.5</span>)</span><br><span class="line">    <span class="keyword">if</span> io.can_recv():</span><br><span class="line">        io.recv()</span><br><span class="line">    io.sendline(pt)</span><br><span class="line">    <span class="comment">#out = io.recv().splitlines()[0].split()[-1]</span></span><br><span class="line">    out = io.recv()</span><br><span class="line">    out = res.search(out).group()</span><br><span class="line">    <span class="keyword">return</span> out</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># function to find f(m)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">SBox</span>(<span class="params">m</span>):</span><br><span class="line">    A0 = m</span><br><span class="line">    B0 = m</span><br><span class="line">    C0 = m ^ x</span><br><span class="line">    D0 = y</span><br><span class="line">    pt = list2hex([A0, B0, C0, D0])</span><br><span class="line">    <span class="comment"># encrypt here</span></span><br><span class="line">    ct = encrypt(pt)</span><br><span class="line">    A6, B6, C6, D6 = hex2list(ct)</span><br><span class="line">    s3 = C6 ^ B0 ^ A0 ^ C0 ^ B6 ^ D6  <span class="comment"># Read the really long hypothesis</span></span><br><span class="line">    <span class="keyword">return</span> s3</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># main function</span></span><br><span class="line"><span class="comment"># io.recv() # localonly</span></span><br><span class="line">start = io.recvuntil(<span class="string">&#x27;): &#x27;</span>)</span><br><span class="line">secret = res.search(start).group()</span><br><span class="line">A6, B6, C6, D6 = hex2list(secret)</span><br><span class="line">m1 = B6 ^ D6</span><br><span class="line">m2 = B6 ^ D6 ^ C6</span><br><span class="line">m3 = C6 ^ A6 ^ B6</span><br><span class="line"></span><br><span class="line">S5 = SBox(m1)</span><br><span class="line">S4 = SBox(m2)</span><br><span class="line">S6 = SBox(m3)</span><br><span class="line"></span><br><span class="line">m4 = C6 ^ A6 ^ S6</span><br><span class="line">m5 = B6 ^ D6 ^ S4</span><br><span class="line"></span><br><span class="line">S1 = SBox(m5)</span><br><span class="line">S3 = SBox(m4)</span><br><span class="line"></span><br><span class="line"><span class="comment">#m6 = B6 ^ C6 ^ D6 ^ S1</span></span><br><span class="line">m6 = C6 ^ A6 ^ B6 ^ S5</span><br><span class="line">S2 = SBox(m6)</span><br><span class="line"></span><br><span class="line">A0 = B0 = C0 = D0 = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> op <span class="keyword">in</span> tab0.keys():</span><br><span class="line">    <span class="built_in">exec</span>(op+<span class="string">&#x27; = &#x27;</span>+<span class="string">&#x27; ^ &#x27;</span>.join(tab0[op]))</span><br><span class="line"><span class="built_in">print</span> list2hex([A0, B0, C0, D0])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># de1ctf&#123;12759ff07f5f8145dfd661cb0f35e1a4&#125;</span></span><br></pre></td></tr></table></figure>

<h2 id="Flag"><a href="#Flag" class="headerlink" title="Flag"></a>Flag</h2><blockquote>
<p>de1ctf{12759ff07f5f8145dfd661cb0f35e1a4}</p>
</blockquote>

  </div>
</article>



        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/about/">About</a></li>
         
          <li><a href="/archives/">Writing</a></li>
         
          <li><a href="/tags/">tags</a></li>
        
      </ul>
    </div>

    <div id="toc-footer" style="display: none">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Challenge-Description"><span class="toc-number">1.</span> <span class="toc-text">Challenge Description</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Attachment"><span class="toc-number">2.</span> <span class="toc-text">Attachment</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#task-py"><span class="toc-number">2.1.</span> <span class="toc-text">task.py</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Enryption-Block-Diagram"><span class="toc-number">3.</span> <span class="toc-text">Enryption Block Diagram</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Observation"><span class="toc-number">4.</span> <span class="toc-text">Observation</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Encryption-Algorithm"><span class="toc-number">4.1.</span> <span class="toc-text">Encryption Algorithm</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Function"><span class="toc-number">4.1.1.</span> <span class="toc-text">Function</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Round-1"><span class="toc-number">4.1.2.</span> <span class="toc-text">Round 1</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Round-2"><span class="toc-number">4.1.3.</span> <span class="toc-text">Round 2</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Round-3"><span class="toc-number">4.1.4.</span> <span class="toc-text">Round 3</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Round-4"><span class="toc-number">4.1.5.</span> <span class="toc-text">Round 4</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Round-5"><span class="toc-number">4.1.6.</span> <span class="toc-text">Round 5</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Round-6"><span class="toc-number">4.1.7.</span> <span class="toc-text">Round 6</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Exploit-Idea"><span class="toc-number">5.</span> <span class="toc-text">Exploit Idea</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Equations"><span class="toc-number">5.1.</span> <span class="toc-text">Equations</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Sbox"><span class="toc-number">5.2.</span> <span class="toc-text">Sbox</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Recovering-Sbox-Values"><span class="toc-number">5.3.</span> <span class="toc-text">Recovering Sbox - Values</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Recovering-Secret"><span class="toc-number">5.4.</span> <span class="toc-text">Recovering Secret</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Exploit"><span class="toc-number">6.</span> <span class="toc-text">Exploit</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Flag"><span class="toc-number">7.</span> <span class="toc-text">Flag</span></a></li></ol>
    </div>

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=http://example.com/2019/08/05/Obscured-De1CTF-2019/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=http://example.com/2019/08/05/Obscured-De1CTF-2019/&text=Obscured - De1CTF 2019"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=http://example.com/2019/08/05/Obscured-De1CTF-2019/&title=Obscured - De1CTF 2019"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=http://example.com/2019/08/05/Obscured-De1CTF-2019/&is_video=false&description=Obscured - De1CTF 2019"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=Obscured - De1CTF 2019&body=Check out this article: http://example.com/2019/08/05/Obscured-De1CTF-2019/"><i class="fas fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=http://example.com/2019/08/05/Obscured-De1CTF-2019/&title=Obscured - De1CTF 2019"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=http://example.com/2019/08/05/Obscured-De1CTF-2019/&title=Obscured - De1CTF 2019"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=http://example.com/2019/08/05/Obscured-De1CTF-2019/&title=Obscured - De1CTF 2019"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=http://example.com/2019/08/05/Obscured-De1CTF-2019/&title=Obscured - De1CTF 2019"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=http://example.com/2019/08/05/Obscured-De1CTF-2019/&name=Obscured - De1CTF 2019&description="><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=http://example.com/2019/08/05/Obscured-De1CTF-2019/&t=Obscured - De1CTF 2019"><i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fas fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fas fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fas fa-share-alt fa-lg" aria-hidden="true"></i> Share</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    Copyright &copy;
    
    
    2019-2022
    Chandu Kona
  </div>
  <div class="footer-right">
    <nav>
      <ul>
        <!--
       --><li><a href="/">Home</a></li><!--
     --><!--
       --><li><a href="/about/">About</a></li><!--
     --><!--
       --><li><a href="/archives/">Writing</a></li><!--
     --><!--
       --><li><a href="/tags/">tags</a></li><!--
     -->
      </ul>
    </nav>
  </div>
</footer>

    </div>
    <!-- styles -->



  <link rel="preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.2/css/all.min.css" crossorigin="anonymous" onload="this.onload=null;this.rel='stylesheet'"/>


    <!-- jquery -->
 
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" crossorigin="anonymous"></script> 




<!-- clipboard -->

  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.7/clipboard.min.js" crossorigin="anonymous"></script> 
  
  <script type="text/javascript">
  $(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"Copy to clipboard!\">";
    btn += '<i class="far fa-clone"></i>';
    btn += '</span>'; 
    // mount it!
    $(".highlight table").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      text: function(trigger) {
        return Array.from(trigger.nextElementSibling.querySelectorAll('.code')).reduce((str,it)=>str+it.innerText+'\n','')
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "Copied!");
      e.clearSelection();
    })
  })
  </script>


<script src="/js/main.js"></script>

<!-- search -->

<!-- Google Analytics -->

    <script async src="https://www.googletagmanager.com/gtag/js?id=G-4V3049N925"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-4V3049N925');
    </script>

<!-- Baidu Analytics -->

<!-- Cloudflare Analytics -->

<!-- Umami Analytics -->

<!-- Disqus Comments -->

<!-- utterances Comments -->

</body>
</html>
